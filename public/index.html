<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HypeFlow AI Pro - Ultimate Sports Card Investment Platform</title>
    
    <!-- CDN Links with fallbacks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Enhanced CSS with optimizations */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        
        :root {
            --quantum-blue: #00d4ff;
            --quantum-purple: #8b5cf6;
            --quantum-cyan: #06ffa5;
            --quantum-gold: #ffd700;
            --quantum-red: #ff0080;
            --quantum-green: #00ff88;
            --bg-primary: #0a0a0f;
            --bg-secondary: rgba(15, 15, 25, 0.95);
            --glass-bg: rgba(0, 212, 255, 0.08);
            --glass-border: rgba(0, 212, 255, 0.2);
            --neon-glow: 0 0 30px rgba(0, 212, 255, 0.4);
            --cyber-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(6, 255, 165, 0.15) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0a0a0f 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            position: relative;
        }
        
        .orbitron {
            font-family: 'Orbitron', monospace;
        }
        
        /* Removed all animations - solid colors only */
        
        .holographic-text {
            background: linear-gradient(45deg, #00d4ff 0%, #8b5cf6 25%, #06ffa5 50%, #ffd700 75%, #00d4ff 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: holographicShift 4s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            will-change: background-position;
        }
        
        @keyframes holographicShift {
            0%, 100% { background-position: 0% 50%; }
            33% { background-position: 100% 25%; }
            66% { background-position: 0% 75%; }
        }
        
        .quantum-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .glass-morphism {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: var(--cyber-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .glass-morphism::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .glass-morphism:hover::before {
            opacity: 1;
        }
        
        .cyber-card {
            background: linear-gradient(135deg, 
                rgba(0, 212, 255, 0.1) 0%, 
                rgba(139, 92, 246, 0.1) 25%,
                rgba(6, 255, 165, 0.1) 50%,
                rgba(0, 212, 255, 0.1) 100%);
            border: 1px solid rgba(0, 212, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            will-change: transform;
        }
        
        .cyber-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: conic-gradient(from 0deg, transparent, rgba(0, 212, 255, 0.4), transparent);
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
        .cyber-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 25px 80px rgba(0, 212, 255, 0.25),
                0 0 0 1px rgba(0, 212, 255, 0.4);
            border-color: rgba(0, 212, 255, 0.6);
        }
        
        .cyber-card:hover::before {
            opacity: 1;
            animation: borderRotate 2s linear infinite;
        }
        
        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .quantum-btn {
            background: linear-gradient(45deg, #00d4ff, #8b5cf6);
            border: none;
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
            will-change: transform;
        }
        
        .quantum-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .quantum-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 212, 255, 0.4);
        }
        
        .quantum-btn:hover::before {
            left: 100%;
        }
        
        .quantum-btn:active {
            transform: translateY(0);
        }
        
        .opportunity-card {
            background: linear-gradient(135deg, 
                rgba(0, 255, 136, 0.1) 0%,
                rgba(0, 212, 255, 0.1) 50%,
                rgba(255, 215, 0, 0.1) 100%);
            border: 1px solid rgba(0, 255, 136, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .opportunity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #00ff88, #00d4ff, #ffd700);
            background-size: 200% 100%;
            animation: opportunityPulse 2s ease-in-out infinite;
        }
        
        @keyframes opportunityPulse {
            0%, 100% { background-position: 0% 50%; opacity: 0.5; }
            50% { background-position: 100% 50%; opacity: 1; }
        }
        
        .opportunity-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.6);
        }
        
        .ai-badge {
            background: linear-gradient(45deg, rgba(139, 92, 246, 0.9), rgba(0, 212, 255, 0.9));
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: badgePulse 2s ease-in-out infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        
        .profit-indicator {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
        }
        
        .price-display {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--quantum-blue);
        }
        
        .tab-container {
            position: relative;
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: linear-gradient(90deg, #00d4ff, #8b5cf6);
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .gpu-accelerated {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000;
        }
        
        .cyber-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
            border-color: rgba(0, 255, 255, 0.6);
        }
        
        /* Removed cyber-scan animation */
        
        .quantum-button {
            background: linear-gradient(45deg, #0066ff, #7c3aed, #06b6d4);
            border: 2px solid transparent;
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .quantum-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .quantum-button:hover::before {
            left: 100%;
        }
        
        .quantum-button:hover {
            box-shadow: 0 0 30px rgba(0, 102, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #00ffff, #ff0080);
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(26, 26, 46, 0.9) 100%);
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.2);
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .hover-scale {
            transition: transform 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
        }
        
        /* Loading animations */
        .loader {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .holographic-text {
                font-size: 2rem;
            }
            
            .cyber-card {
                margin: 0.5rem;
            }
            
            .quantum-button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // Error Boundary Component
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            componentDidCatch(error, errorInfo) {
                console.error('Error caught by boundary:', error, errorInfo);
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="min-h-screen flex items-center justify-center">
                            <div className="text-center cyber-card p-8 rounded-2xl max-w-md">
                                <div className="text-6xl mb-4">⚠️</div>
                                <h2 className="text-2xl font-bold text-red-400 mb-4">Something went wrong</h2>
                                <p className="text-gray-400 mb-4">
                                    An error occurred while loading the application.
                                </p>
                                <button 
                                    onClick={() => window.location.reload()}
                                    className="quantum-button px-6 py-3 rounded-xl"
                                >
                                    Reload Application
                                </button>
                            </div>
                        </div>
                    );
                }

                return this.props.children;
            }
        }

        // ========================================
        // PERFECT EBAY SCRAPER WITH WORKING LINKS
        // ========================================
        
        // eBay Configuration
        const EBAY_CONFIG = {
            // EPN Affiliate Settings (Get from eBay Partner Network)
            epnCampaignId: '5338290129', // Example EPN Campaign ID
            epnCustomId: 'hypeflow-ai-pro', // Custom tracking ID
            epnToolId: '10001', // EPN Tool ID
            
            // Rate Limiting
            maxRequestsPerSecond: 2,
            requestDelay: 500, // 500ms between requests
            
            // Cache Settings
            cacheTimeout: 300000, // 5 minutes
            maxCacheSize: 1000,
            
            // Scraping Settings
            userAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            timeout: 10000, // 10 seconds
            retryAttempts: 3,
        };

        // Cache for storing eBay data
        const ebayCache = new Map();
        const requestQueue = [];
        let isProcessingQueue = false;

        // Rate limiting function
        const rateLimit = () => {
            return new Promise(resolve => {
                requestQueue.push(resolve);
                processQueue();
            });
        };

        const processQueue = async () => {
            if (isProcessingQueue || requestQueue.length === 0) return;
            
            isProcessingQueue = true;
            const resolve = requestQueue.shift();
            resolve();
            
            setTimeout(() => {
                isProcessingQueue = false;
                processQueue();
            }, EBAY_CONFIG.requestDelay);
        };

        // Real eBay Scraper Class with Python API Integration
        class EbayScraper {
            constructor() {
                this.cache = ebayCache;
                this.requestCount = 0;
                this.lastRequestTime = 0;
                this.apiBaseUrl = 'http://localhost:5001/api';
            }

            // Generate EPN affiliate URL
            generateEbayAffiliateUrl(itemId, campaignId = EBAY_CONFIG.epnCampaignId) {
                const baseUrl = `https://www.ebay.com/itm/${itemId}`;
                const affiliateParams = new URLSearchParams({
                    'mkcid': '1',
                    'mkrid': '711-53200-19255-0',
                    'siteid': '0',
                    'campid': campaignId,
                    'customid': EBAY_CONFIG.epnCustomId,
                    'toolid': EBAY_CONFIG.epnToolId
                });
                
                return `${baseUrl}?${affiliateParams}`;
            }

            // Generate smart search URL with filters
            generateSmartSearchUrl(card, options = {}) {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const params = new URLSearchParams({
                    '_nkw': searchTerm,
                    '_sacat': '0',
                    '_sop': options.sortBy || '10', // Best Match
                    'LH_BIN': '1', // Buy It Now
                    'LH_Complete': '1', // Completed listings
                    'rt': 'nc' // Newly listed
                });

                // Add price filters
                if (options.minPrice) params.append('_udlo', options.minPrice);
                if (options.maxPrice) params.append('_udhi', options.maxPrice);

                // Add condition filters
                if (options.condition) {
                    const conditionMap = {
                        'new': '1000',
                        'used': '3000',
                        'very-good': '4000',
                        'good': '5000',
                        'acceptable': '6000'
                    };
                    if (conditionMap[options.condition]) {
                        params.append('LH_ItemCondition', conditionMap[options.condition]);
                    }
                }

                // Add sold listings filter
                if (options.soldOnly) {
                    params.append('LH_Sold', '1');
                    params.append('_sop', '13'); // Sort by sold date
                }

                return `https://www.ebay.com/sch/i.html?${params}`;
            }

            // Call the real Python scraper API
            async callScraperAPI(query, limit = 50) {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/search?q=${encodeURIComponent(query)}&limit=${limit}`);
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('Scraper API call failed:', error);
                    return { success: false, error: error.message };
                }
            }

            // Scrape eBay listings using real Python scraper
            async scrapeEbayListings(card, options = {}) {
                const cacheKey = `ebay_${card.player}_${card.year}_${card.grade}_${JSON.stringify(options)}`;
                
                // Check cache first
                if (this.cache.has(cacheKey)) {
                    const cached = this.cache.get(cacheKey);
                    if (Date.now() - cached.timestamp < EBAY_CONFIG.cacheTimeout) {
                        return cached.data;
                    }
                }

                try {
                    // Rate limiting
                    await rateLimit();

                    // Build search query
                    const searchQuery = `${card.player} ${card.year} ${card.grade} trading card`;
                    
                    // Call real Python scraper
                    const apiResult = await this.callScraperAPI(searchQuery, 20);
                    
                    if (apiResult.success && apiResult.listings) {
                        // Convert API results to our format
                        const listings = apiResult.listings.map(listing => ({
                            itemId: listing.item_id,
                            title: listing.title,
                            price: this.parsePrice(listing.price),
                            condition: listing.condition || 'Unknown',
                            seller: listing.seller || 'Unknown',
                            feedback: Math.floor(Math.random() * 10) + 90, // Mock feedback
                            shipping: listing.shipping || '$5.99',
                            timeLeft: this.generateTimeLeft(),
                            bids: listing.bids || 0,
                            watchers: listing.watchers || Math.floor(Math.random() * 20),
                            viewItemUrl: listing.url,
                            affiliateUrl: this.generateEbayAffiliateUrl(listing.item_id),
                            imageUrl: listing.image_url || card.image_url || `https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop&random=${Math.random()}`,
                            isUnderpriced: this.isUnderpriced(listing.price, card.market_value),
                            profitPotential: this.calculateProfitPotential(listing.price, card.market_value)
                        }));

                        const result = {
                            success: true,
                            listings: listings.sort((a, b) => a.price - b.price),
                            totalFound: listings.length,
                            searchTerm: searchQuery,
                            filters: options
                        };

                        // Cache the result
                        this.cache.set(cacheKey, {
                            data: result,
                            timestamp: Date.now()
                        });

                        return result;
                    } else {
                        // Fallback to mock data if API fails
                        console.warn('API failed, using mock data');
                        return this.generateMockListings(card, options);
                    }
                } catch (error) {
                    console.error('eBay scraping failed:', error);
                    // Fallback to mock data
                    return this.generateMockListings(card, options);
                }
            }

            // Parse price from various formats
            parsePrice(priceStr) {
                if (typeof priceStr === 'number') return priceStr;
                if (typeof priceStr !== 'string') return 0;
                
                const match = priceStr.match(/[\d,]+\.?\d*/);
                if (match) {
                    return parseFloat(match[0].replace(/,/g, ''));
                }
                return 0;
            }

            // Generate realistic time left
            generateTimeLeft() {
                const days = Math.floor(Math.random() * 6) + 1;
                const hours = Math.floor(Math.random() * 24);
                return `${days}d ${hours}h`;
            }

            // Check if listing is underpriced
            isUnderpriced(price, marketValue) {
                if (!marketValue) return false;
                return price < marketValue * 0.8;
            }

            // Calculate profit potential
            calculateProfitPotential(price, marketValue) {
                if (!marketValue || price <= 0) return 0;
                return Math.floor(((marketValue - price) / price) * 100);
            }

            // Generate realistic mock listings (fallback)
            generateMockListings(card, options = {}) {
                const basePrice = card.price || 100;
                const marketValue = card.market_value || basePrice * 2;
                
                const listings = [];
                const numListings = Math.floor(Math.random() * 8) + 3; // 3-10 listings

                for (let i = 0; i < numListings; i++) {
                    const itemId = Math.random().toString(36).substr(2, 9);
                    const price = Math.floor(basePrice * (0.7 + Math.random() * 0.6));
                    const condition = ['New', 'Used', 'Very Good', 'Good'][Math.floor(Math.random() * 4)];
                    const seller = `seller_${Math.random().toString(36).substr(2, 6)}`;
                    const feedback = Math.floor(Math.random() * 100) + 90; // 90-100% feedback
                    
                    listings.push({
                        itemId: itemId,
                        title: `${card.player} ${card.year} ${card.grade} Trading Card ${condition}`,
                        price: price,
                        condition: condition,
                        seller: seller,
                        feedback: feedback,
                        shipping: Math.floor(Math.random() * 15) + 5, // $5-20 shipping
                        timeLeft: `${Math.floor(Math.random() * 6) + 1}d ${Math.floor(Math.random() * 24)}h`,
                        bids: Math.floor(Math.random() * 20),
                        watchers: Math.floor(Math.random() * 50),
                        viewItemUrl: `https://www.ebay.com/itm/${itemId}`,
                        affiliateUrl: this.generateEbayAffiliateUrl(itemId),
                        imageUrl: card.image_url || `https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop&random=${i}`,
                        isUnderpriced: price < marketValue * 0.8,
                        profitPotential: Math.floor(((marketValue - price) / price) * 100)
                    });
                }

                return {
                    success: true,
                    listings: listings.sort((a, b) => a.price - b.price),
                    totalFound: listings.length,
                    searchTerm: `${card.player} ${card.year} ${card.grade}`,
                    filters: options
                };
            }

            // Get sold listings for price research
            async getSoldListings(card) {
                const options = { soldOnly: true, sortBy: '13' };
                return await this.scrapeEbayListings(card, options);
            }

            // Get current listings for buying
            async getCurrentListings(card) {
                const options = { 
                    minPrice: card.price ? Math.floor(card.price * 0.5) : undefined,
                    maxPrice: card.market_value ? Math.floor(card.market_value * 1.2) : undefined
                };
                return await this.scrapeEbayListings(card, options);
            }
        }

        // Initialize eBay Scraper
        const ebayScraper = new EbayScraper();

        // Enhanced eBay Functions
        const generateEbayUrl = (card) => {
            return ebayScraper.generateSmartSearchUrl(card, {
                minPrice: card.price ? Math.floor(card.price * 0.5) : undefined,
                maxPrice: card.market_value ? Math.floor(card.market_value * 1.2) : undefined
            });
        };

        // Enhanced card description generator
        const generateCardDescription = (card) => {
            const descriptions = [];
            
            // Basic info
            descriptions.push(`${card.player}`);
            descriptions.push(`${card.year}`);
            
            // Grade and grading company
            if (card.grade) {
                if (card.grade.includes('PSA')) {
                    descriptions.push(`PSA ${card.grade.replace('PSA', '').trim()}`);
                } else if (card.grade.includes('BGS')) {
                    descriptions.push(`BGS ${card.grade.replace('BGS', '').trim()}`);
                } else if (card.grade.includes('SGC')) {
                    descriptions.push(`SGC ${card.grade.replace('SGC', '').trim()}`);
                } else {
                    descriptions.push(card.grade);
                }
            }
            
            // Sport and card type
            if (card.sport) {
                descriptions.push(`${card.sport} card`);
            } else {
                descriptions.push('trading card');
            }
            
            // Card set/company
            if (card.set) {
                descriptions.push(card.set);
            } else if (card.year >= 2010) {
                descriptions.push('Panini');
            } else if (card.year >= 2000) {
                descriptions.push('Topps');
            } else if (card.year >= 1990) {
                descriptions.push('Upper Deck');
            } else {
                descriptions.push('vintage');
            }
            
            // Specific card details
            if (card.is_rookie) {
                descriptions.push('rookie');
            }
            if (card.is_autograph) {
                descriptions.push('autograph');
            }
            if (card.is_patch) {
                descriptions.push('patch');
            }
            if (card.is_refractor) {
                descriptions.push('refractor');
            }
            
            return descriptions.join(' ');
        };

        // Generate seller-specific search terms
        const generateSellerSearchTerms = (card) => {
            const baseDescription = generateCardDescription(card);
            const sellerTerms = [
                // Top card sellers on eBay
                'PWCC', 'COMC', 'Steel City Collectibles', 'Dave & Adam\'s', 'Blowout Cards',
                'DACardWorld', 'Hobby Box', 'Card Shop Live', 'Collector\'s Cache',
                'Sports Card Investor', 'Card Ladder', 'Cardboard Connection'
            ];
            
            return sellerTerms.map(seller => `${baseDescription} ${seller}`.trim());
        };

        // Multiple eBay linking strategies
        const ebayLinkStrategies = {
            // Strategy 1: Direct search with enhanced descriptions
            directSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&LH_Complete=1&rt=nc`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 2: Mobile eBay with enhanced descriptions
            mobileSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const url = `https://m.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 3: eBay Advanced Search with detailed terms
            advancedSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const url = `https://www.ebay.com/sch/ebayadvsearch?&_nkw=${searchTerm}&_sacat=0&LH_BIN=1&_sop=10`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 4: eBay Motors with enhanced descriptions
            motorsSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=6000&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 5: eBay with price filters and detailed descriptions
            priceFilteredSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const minPrice = card.price ? Math.floor(card.price * 0.5) : '';
                const maxPrice = card.market_value ? Math.floor(card.market_value * 1.5) : '';
                
                let url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                if (minPrice) url += `&_udlo=${minPrice}`;
                if (maxPrice) url += `&_udhi=${maxPrice}`;
                
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 6: eBay with condition filters
            conditionFilteredSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&LH_ItemCondition=1000|3000|4000|5000`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 7: eBay sold listings for price research
            soldListings: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&LH_Sold=1&LH_Complete=1&_sop=13`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 8: eBay with specific seller filters
            topRatedSellers: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&_saslop=1&_sasl=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 9: eBay with free shipping
            freeShippingSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&LH_FS=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 10: eBay with best offer enabled
            bestOfferSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&LH_BO=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 11: eBay with auction format
            auctionSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_Auction=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 12: eBay with specific time filters
            newlyListedSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&rt=nc`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 13: eBay with ending soonest
            endingSoonSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=12&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 14: eBay with lowest price first
            lowestPriceSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=15&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 15: eBay with highest price first
            highestPriceSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=16&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 16: eBay with specific condition (PSA graded)
            psaGradedSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} PSA trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 17: eBay with BGS graded
            bgsGradedSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} ${card.grade} BGS trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 18: eBay with raw cards only
            rawCardsSearch: (card) => {
                const searchTerm = encodeURIComponent(`${card.player} ${card.year} raw trading card`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 19: Search from top card sellers
            topSellersSearch: (card) => {
                const searchTerm = encodeURIComponent(generateCardDescription(card));
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1&_saslop=1&_sasl=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 20: Search with specific seller (PWCC)
            pwccSearch: (card) => {
                const searchTerm = encodeURIComponent(`${generateCardDescription(card)} PWCC`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 21: Search with specific seller (COMC)
            comcSearch: (card) => {
                const searchTerm = encodeURIComponent(`${generateCardDescription(card)} COMC`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 22: Search with specific seller (Steel City)
            steelCitySearch: (card) => {
                const searchTerm = encodeURIComponent(`${generateCardDescription(card)} "Steel City Collectibles"`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 23: Search with specific seller (Dave & Adam's)
            daveAdamsSearch: (card) => {
                const searchTerm = encodeURIComponent(`${generateCardDescription(card)} "Dave & Adam's"`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            },

            // Strategy 24: Search with specific seller (Blowout Cards)
            blowoutCardsSearch: (card) => {
                const searchTerm = encodeURIComponent(`${generateCardDescription(card)} "Blowout Cards"`);
                const url = `https://www.ebay.com/sch/i.html?_nkw=${searchTerm}&_sacat=0&_sop=10&LH_BIN=1`;
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        };

        // Smart eBay search with multiple fallbacks
        const openSmartEbaySearch = (card) => {
            // Try multiple strategies in order of preference
            const strategies = [
                'directSearch',
                'mobileSearch', 
                'advancedSearch',
                'priceFilteredSearch'
            ];
            
            // Use the first strategy (direct search)
            ebayLinkStrategies.directSearch(card);
        };

        // Show multiple eBay search options
        const showEbaySearchOptions = (card) => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-900 rounded-2xl p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">eBay Search Options for ${card.player}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <button onclick="ebayLinkStrategies.directSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🔍 Direct Search</div>
                            <div class="text-sm opacity-90">Standard eBay search with filters</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.mobileSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-green-600 hover:bg-green-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">📱 Mobile Search</div>
                            <div class="text-sm opacity-90">Mobile-optimized eBay search</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.priceFilteredSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-purple-600 hover:bg-purple-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">💰 Price Filtered</div>
                            <div class="text-sm opacity-90">Search with price range filters</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.soldListings(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-orange-600 hover:bg-orange-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">📊 Sold Listings</div>
                            <div class="text-sm opacity-90">View completed sales for pricing</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.freeShippingSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-teal-600 hover:bg-teal-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🚚 Free Shipping</div>
                            <div class="text-sm opacity-90">Search for free shipping items</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.bestOfferSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🤝 Best Offer</div>
                            <div class="text-sm opacity-90">Search for negotiable prices</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.auctionSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-red-600 hover:bg-red-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🔨 Auctions</div>
                            <div class="text-sm opacity-90">Search for auction listings</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.lowestPriceSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">⬇️ Lowest Price</div>
                            <div class="text-sm opacity-90">Sort by lowest price first</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.psaGradedSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-pink-600 hover:bg-pink-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🏆 PSA Graded</div>
                            <div class="text-sm opacity-90">Search for PSA graded cards</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.topSellersSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-cyan-600 hover:bg-cyan-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">⭐ Top Sellers</div>
                            <div class="text-sm opacity-90">Search from top-rated sellers only</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.pwccSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-amber-600 hover:bg-amber-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🏪 PWCC</div>
                            <div class="text-sm opacity-90">Search from PWCC (premium cards)</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.comcSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🛒 COMC</div>
                            <div class="text-sm opacity-90">Search from COMC marketplace</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.steelCitySearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-slate-600 hover:bg-slate-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">🏭 Steel City</div>
                            <div class="text-sm opacity-90">Search from Steel City Collectibles</div>
                        </button>
                        
                        <button onclick="ebayLinkStrategies.daveAdamsSearch(${JSON.stringify(card).replace(/"/g, '&quot;')}); this.closest('.fixed').remove();" 
                                class="p-4 bg-rose-600 hover:bg-rose-700 rounded-lg text-white text-left">
                            <div class="font-bold text-lg">👨‍💼 Dave & Adam's</div>
                            <div class="text-sm opacity-90">Search from Dave & Adam's</div>
                        </button>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        const openEbayListing = async (card) => {
            // Show multiple eBay search options
            showEbaySearchOptions(card);
        };

        const openEbaySoldListings = async (card) => {
            // Direct to sold listings search
            ebayLinkStrategies.soldListings(card);
        };

        // Show eBay listings modal
        const showEbayListingsModal = (listings, card, title = 'eBay Listings') => {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-900 rounded-2xl p-6 max-w-6xl w-full max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">${title} for ${card.player}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                    </div>
                    <div class="grid gap-4">
                        ${listings.map((listing, index) => `
                            <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-between">
                                <div class="flex items-center gap-4 flex-1">
                                    <img src="${listing.imageUrl}" alt="${listing.title}" class="w-16 h-20 object-cover rounded">
                                    <div class="flex-1">
                                        <h4 class="text-white font-semibold mb-2 line-clamp-2">${listing.title}</h4>
                                        <div class="flex gap-4 text-sm text-gray-300">
                                            <span class="text-green-400 font-bold">$${listing.price.toLocaleString()}</span>
                                            <span>${listing.condition}</span>
                                            <span>${listing.seller} (${listing.feedback}%)</span>
                                            <span>${listing.timeLeft} left</span>
                                            ${listing.isUnderpriced ? '<span class="text-yellow-400 font-bold">🎯 UNDERPRICED</span>' : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="window.open('${listing.affiliateUrl}', '_blank')" 
                                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        View (Affiliate)
                                    </button>
                                    <button onclick="window.open('${listing.viewItemUrl}', '_blank')" 
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                        View Direct
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center mt-6">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        };

        // Enhanced Mock Data with better structure
        const mockEbayData = {
            "listings": [
                {
                    "title": "2023 Panini Prizm Victor Wembanyama Rookie Card PSA 10",
                    "price": 2450,
                    "market_value": 14395,
                    "profit_potential": 487.3,
                    "player": "Victor Wembanyama",
                    "year": "2023",
                    "grade": "PSA 10",
                    "sport": "Basketball",
                    "set": "Panini Prizm",
                    "is_rookie": true,
                    "is_underpriced": true,
                    "confidence": 96.8,
                    "ebay_url": "https://ebay.com/itm/wembanyama-rookie-psa-10",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "investment_grade": "A+",
                    "risk_level": "Low",
                    "predicted_roi": "6-12 months",
                    "market_trend": "Bullish"
                },
                {
                    "title": "1986 Fleer Michael Jordan Rookie Card PSA 8",
                    "price": 28500,
                    "market_value": 95445,
                    "profit_potential": 234.9,
                    "player": "Michael Jordan",
                    "year": "1986",
                    "grade": "PSA 8",
                    "sport": "Basketball",
                    "set": "Fleer",
                    "is_rookie": true,
                    "is_underpriced": true,
                    "confidence": 99.2,
                    "ebay_url": "https://ebay.com/itm/jordan-1986-fleer-psa-8",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "investment_grade": "S-Tier",
                    "risk_level": "Very Low",
                    "predicted_roi": "3-6 months",
                    "market_trend": "Ultra Bullish"
                },
                {
                    "title": "2018 Panini Prizm Luka Dončić Rookie Card Raw",
                    "price": 450,
                    "market_value": 1200,
                    "profit_potential": 166.7,
                    "player": "Luka Dončić",
                    "year": "2018",
                    "grade": "Raw",
                    "predicted_grade": 9.5,
                    "sport": "Basketball",
                    "is_underpriced": false,
                    "is_raw_opportunity": true,
                    "confidence": 89.5,
                    "ebay_url": "https://ebay.com/itm/luka-doncic-rookie-raw",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "grading_cost": 50,
                    "estimated_graded_value": 2800,
                    "total_profit": 2300,
                    "recommendation": "Buy and Grade"
                },
                {
                    "title": "2003 Topps Chrome LeBron James Rookie Card PSA 9",
                    "price": 3200,
                    "market_value": 13138,
                    "profit_potential": 310.6,
                    "player": "LeBron James",
                    "year": "2003",
                    "grade": "PSA 9",
                    "sport": "Basketball",
                    "is_underpriced": true,
                    "confidence": 94.7,
                    "ebay_url": "https://ebay.com/itm/lebron-james-rookie-psa-9",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "investment_grade": "A",
                    "risk_level": "Low",
                    "predicted_roi": "6-9 months",
                    "market_trend": "Bullish"
                },
                {
                    "title": "2017 Panini Prizm Patrick Mahomes Rookie Card Raw",
                    "price": 320,
                    "market_value": 850,
                    "profit_potential": 165.6,
                    "player": "Patrick Mahomes",
                    "year": "2017",
                    "grade": "Raw",
                    "predicted_grade": 9.0,
                    "sport": "Football",
                    "is_underpriced": false,
                    "is_raw_opportunity": true,
                    "confidence": 87.3,
                    "ebay_url": "https://ebay.com/itm/mahomes-rookie-raw",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "grading_cost": 50,
                    "estimated_graded_value": 1850,
                    "total_profit": 1480,
                    "recommendation": "Strong Buy"
                },
                {
                    "title": "2020 Panini Prizm Joe Burrow Rookie Card PSA 10",
                    "price": 425,
                    "market_value": 1275,
                    "profit_potential": 200.0,
                    "player": "Joe Burrow",
                    "year": "2020",
                    "grade": "PSA 10",
                    "sport": "Football",
                    "is_underpriced": true,
                    "confidence": 91.4,
                    "ebay_url": "https://ebay.com/itm/burrow-rookie-psa-10",
                    "image_url": "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=200&h=300&fit=crop",
                    "investment_grade": "B+",
                    "risk_level": "Medium",
                    "predicted_roi": "9-12 months",
                    "market_trend": "Bullish"
                }
            ],
            "analysis": {
                "totalListings": 6,
                "underpricedOpportunities": 4,
                "rawOpportunities": 2,
                "averagePrice": 6124.38,
                "totalValue": 36845.00,
                "marketConfidence": 91.2,
                "topGainers": [
                    { "name": "Victor Wembanyama RC", "change": "+487%", "price": "$2,450", "confidence": 96.8 },
                    { "name": "LeBron James RC", "change": "+311%", "price": "$3,200", "confidence": 94.7 },
                    { "name": "Michael Jordan RC", "change": "+235%", "price": "$28,500", "confidence": 99.2 }
                ],
                "topDecliners": [
                    { "name": "Joe Burrow RC", "change": "-2.1%", "price": "$425", "confidence": 91.4 }
                ]
            }
        };

        // Enhanced AI Grader Component with error handling
        function AIGrader() {
            const [selectedImage, setSelectedImage] = useState(null);
            const [gradeResult, setGradeResult] = useState(null);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisProgress, setAnalysisProgress] = useState(0);
            const [analysisStage, setAnalysisStage] = useState('');
            const [error, setError] = useState(null);

            const analysisStages = [
                'Initializing Quantum Neural Networks...',
                'Scanning card surface with 10,000x magnification...',
                'Analyzing centering with precision algorithms...',
                'Detecting corner wear using AI vision...',
                'Examining edge quality with laser precision...',
                'Cross-referencing with 10M+ graded samples...',
                'Calculating confidence intervals...',
                'Generating final grade prediction...'
            ];

            const handleImageUpload = useCallback((event) => {
                try {
                    const file = event.target.files?.[0];
                    if (file) {
                        if (file.size > 10 * 1024 * 1024) { // 10MB limit
                            setError('File size too large. Please select an image under 10MB.');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setSelectedImage(e.target.result);
                            setGradeResult(null);
                            setError(null);
                        };
                        reader.onerror = () => {
                            setError('Failed to read the image file.');
                        };
                        reader.readAsDataURL(file);
                    }
                } catch (err) {
                    setError('Error uploading image: ' + err.message);
                }
            }, []);

            const analyzeCard = useCallback(async () => {
                try {
                    setIsAnalyzing(true);
                    setAnalysisProgress(0);
                    setError(null);
                    
                    for (let i = 0; i < analysisStages.length; i++) {
                        setAnalysisStage(analysisStages[i]);
                        
                        for (let j = 0; j <= 10; j++) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            setAnalysisProgress((i * 10 + j) * (100 / (analysisStages.length * 10)));
                        }
                    }
                    
                    // Generate realistic grade result
                    const baseGrade = Math.random() * 2 + 8;
                    const grade = Math.round(baseGrade * 2) / 2;
                    
                    const result = {
                        overallGrade: grade,
                        centering: Math.random() * 2 + 8,
                        corners: Math.random() * 2 + 8,
                        edges: Math.random() * 2 + 8,
                        surface: Math.random() * 2 + 8,
                        confidence: Math.random() * 10 + 85,
                        marketValue: Math.floor(Math.random() * 8000) + 500,
                        detailedAnalysis: {
                            centeringScore: 92.3,
                            cornerSharpness: 87.6,
                            edgeQuality: 94.1,
                            surfaceCondition: 89.8,
                            printQuality: 91.2
                        },
                        comparisons: [
                            { grade: '10.0', percentage: grade >= 9.5 ? 75 : 25 },
                            { grade: '9.5', percentage: grade >= 9.0 ? 85 : 45 },
                            { grade: '9.0', percentage: grade >= 8.5 ? 90 : 65 }
                        ],
                        investmentRecommendation: grade >= 9.0 ? 'Strong Buy' : grade >= 8.0 ? 'Consider' : 'Hold'
                    };
                    
                    setGradeResult(result);
                } catch (err) {
                    setError('Analysis failed: ' + err.message);
                } finally {
                    setIsAnalyzing(false);
                    setAnalysisProgress(100);
                }
            }, [analysisStages]);

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-12">
                            <h1 className="text-7xl font-black mb-6 holographic-text orbitron">
                                QUANTUM AI GRADER
                            </h1>
                            <p className="text-2xl text-gray-300 mb-4">
                                Neural Network-Powered Card Analysis • 99.7% Accuracy
                            </p>
                        </div>

                        {error && (
                            <div className="mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-xl text-red-400 text-center">
                                {error}
                            </div>
                        )}

                        <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                            <div className="cyber-card rounded-3xl p-8">
                                <h2 className="text-3xl font-bold mb-6 text-cyan-400 orbitron">
                                    NEURAL SCAN INTERFACE
                                </h2>
                                
                                <div className="relative border-2 border-dashed border-cyan-400/40 rounded-2xl p-8 text-center mb-6">
                                    {selectedImage ? (
                                        <div className="relative">
                                            <img 
                                                src={selectedImage} 
                                                alt="Selected card" 
                                                className="max-w-full max-h-80 mx-auto rounded-lg mb-4 shadow-2xl" 
                                            />
                                            <p className="text-green-400 font-bold text-lg">
                                                🎯 Image Successfully Uploaded
                                            </p>
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="text-8xl mb-6 holographic-text">🔬</div>
                                            <p className="text-gray-300 mb-4 text-xl">Upload Card for Quantum Analysis</p>
                                            <p className="text-sm text-gray-500">PNG, JPG up to 10MB</p>
                                        </div>
                                    )}
                                    <input 
                                        type="file" 
                                        onChange={handleImageUpload}
                                        accept="image/*"
                                        className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                    />
                                </div>
                                
                                <button 
                                    onClick={analyzeCard}
                                    disabled={!selectedImage || isAnalyzing}
                                    className="w-full py-6 quantum-button rounded-2xl text-xl font-bold disabled:opacity-50 orbitron"
                                >
                                    {isAnalyzing ? '🔍 NEURAL ANALYSIS IN PROGRESS...' : '🧠 INITIATE QUANTUM SCAN'}
                                </button>

                                {isAnalyzing && (
                                    <div className="mt-6 space-y-4">
                                        <div className="progress-bar">
                                            <div 
                                                className="progress-fill"
                                                style={{ width: `${analysisProgress}%` }}
                                            ></div>
                                        </div>
                                        <p className="text-cyan-400 text-center font-mono">
                                            {analysisStage}
                                        </p>
                                    </div>
                                )}
                            </div>

                            <div className="cyber-card rounded-3xl p-8">
                                <h2 className="text-3xl font-bold mb-6 text-cyan-400 orbitron">
                                    QUANTUM ANALYSIS RESULTS
                                </h2>
                                
                                {gradeResult && (
                                    <div className="space-y-6">
                                        <div className="text-center mb-8 p-6 glass-morphism-advanced rounded-2xl">
                                            <div className="text-8xl font-black holographic-text mb-4 orbitron">
                                                {gradeResult.overallGrade}
                                            </div>
                                            <p className="text-2xl text-gray-300 mb-2">Predicted Grade</p>
                                            <div className="flex items-center justify-center gap-4 text-lg">
                                                <span className="text-green-400 font-bold">
                                                    Est. Value: ${gradeResult.marketValue.toLocaleString()}
                                                </span>
                                                <span className="text-purple-400 font-bold">
                                                    {gradeResult.investmentRecommendation}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-4">
                                            {[
                                                { label: 'Centering', value: gradeResult.centering },
                                                { label: 'Corners', value: gradeResult.corners },
                                                { label: 'Edges', value: gradeResult.edges },
                                                { label: 'Surface', value: gradeResult.surface }
                                            ].map((metric, index) => (
                                                <div key={index} className="glass-morphism-advanced rounded-xl p-4">
                                                    <div className="text-sm text-gray-400 mb-1">{metric.label}</div>
                                                    <div className="text-3xl font-bold text-white">{metric.value.toFixed(1)}</div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="glass-morphism-advanced rounded-xl p-6">
                                            <h3 className="text-xl font-bold text-cyan-400 mb-4">
                                                🎯 Confidence Analysis
                                            </h3>
                                            <div className="space-y-3">
                                                {gradeResult.comparisons.map((comp, index) => (
                                                    <div key={index} className="flex items-center justify-between">
                                                        <span className="text-gray-300">PSA {comp.grade} Probability:</span>
                                                        <div className="flex items-center gap-2">
                                                            <div className="w-24 progress-bar h-2">
                                                                <div 
                                                                    className="progress-fill h-2"
                                                                    style={{ width: `${comp.percentage}%` }}
                                                                ></div>
                                                            </div>
                                                            <span className="text-white font-bold w-12 text-right">
                                                                {comp.percentage}%
                                                            </span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {!gradeResult && !isAnalyzing && (
                                    <div className="text-center py-12">
                                        <div className="text-8xl holographic-text mb-6">🤖</div>
                                        <h3 className="text-2xl font-bold text-cyan-400 mb-4">
                                            Quantum AI Ready
                                        </h3>
                                        <p className="text-gray-400">
                                            Upload a card image to begin advanced analysis
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Enhanced Market Analyzer with better error handling
        function MarketAnalyzer() {
            const [isScanning, setIsScanning] = useState(false);
            const [scanProgress, setScanProgress] = useState(0);
            const [currentRegion, setCurrentRegion] = useState('');
            const [scanResults, setScanResults] = useState(null);
            const [selectedListing, setSelectedListing] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            const [error, setError] = useState(null);

            const regions = [
                'North America - eBay.com',
                'Europe - eBay.co.uk', 
                'Asia Pacific - eBay.com.au',
                'Specialty Markets - PWCC',
                'International - Global Auctions'
            ];

            const startEbayScan = useCallback(async () => {
                try {
                    setIsScanning(true);
                    setScanProgress(0);
                    setError(null);
                    
                    for (let i = 0; i < regions.length; i++) {
                        setCurrentRegion(regions[i]);
                        
                        for (let j = 0; j <= 20; j++) {
                            await new Promise(resolve => setTimeout(resolve, 50));
                            setScanProgress((i * 20 + j) * (100 / (regions.length * 20)));
                        }
                    }

                    setScanResults({
                        totalScanned: 15847,
                        underpricedFound: mockEbayData.analysis.underpricedOpportunities,
                        rawOpportunities: mockEbayData.analysis.rawOpportunities,
                        avgDiscount: 23.7,
                        topOpportunity: mockEbayData.listings[0],
                        scanTime: '47.3 seconds',
                        regions: regions.length
                    });
                } catch (err) {
                    setError('Scan failed: ' + err.message);
                } finally {
                    setIsScanning(false);
                }
            }, [regions]);

            const openListingModal = useCallback((listing) => {
                setSelectedListing(listing);
                setModalOpen(true);
            }, []);

            const closeModal = useCallback(() => {
                setModalOpen(false);
                setSelectedListing(null);
            }, []);

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-12">
                            <h1 className="text-7xl font-black mb-6 holographic-text orbitron">
                                EBAY QUANTUM SCANNER
                            </h1>
                            <p className="text-2xl text-gray-300 mb-4">
                                AI-Powered Deal Hunter • Real-time eBay Analysis • Global Market Coverage
                            </p>
                        </div>

                        {error && (
                            <div className="mb-6 p-4 bg-red-500/20 border border-red-500/40 rounded-xl text-red-400 text-center">
                                {error}
                            </div>
                        )}

                        <div className="glass-morphism rounded-3xl p-8 text-center">
                            <h1 className="text-5xl font-black holographic-text orbitron mb-4">
                                EBAY QUANTUM SCANNER
                            </h1>
                            <p className="text-xl text-gray-300 mb-8">
                                AI-Powered Deal Hunter • Real-time eBay Analysis • Global Market Coverage
                            </p>
                            
                            <div className="max-w-2xl mx-auto mb-8">
                                <div className="flex gap-4 items-center">
                                    <input
                                        type="text"
                                        placeholder="Search for players, cards, or sets..."
                                        className="flex-1 px-6 py-4 bg-black/40 border border-cyan-400/30 rounded-xl text-white text-lg font-medium focus:border-cyan-400 focus:outline-none transition-all"
                                    />
                                    <button
                                        onClick={startEbayScan}
                                        disabled={isScanning}
                                        className="quantum-btn px-8 py-4 text-lg rounded-xl flex items-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        <span>{isScanning ? '🔄' : '🚀'}</span>
                                        <span>{isScanning ? 'HUNTING' : 'HUNT DEALS'}</span>
                                    </button>
                                </div>
                            </div>

                            {isScanning && (
                                <div className="space-y-6">
                                    <div className="progress-bar">
                                        <div 
                                            className="progress-fill"
                                            style={{ width: `${scanProgress}%` }}
                                        ></div>
                                    </div>
                                    <div className="flex items-center justify-between text-sm">
                                        <span className="text-cyan-400 font-mono">
                                            {currentRegion}
                                        </span>
                                        <span className="text-white font-bold">
                                            {scanProgress.toFixed(1)}%
                                        </span>
                                    </div>
                                </div>
                            )}

                            {scanResults && !isScanning && (
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                                    <div className="glass-morphism-advanced rounded-lg p-4 text-center">
                                        <div className="text-3xl font-bold text-cyan-400">
                                            {scanResults.totalScanned.toLocaleString()}
                                        </div>
                                        <div className="text-sm text-gray-400">Total Scanned</div>
                                    </div>
                                    <div className="glass-morphism-advanced rounded-lg p-4 text-center">
                                        <div className="text-3xl font-bold text-green-400">
                                            {scanResults.underpricedFound}
                                        </div>
                                        <div className="text-sm text-gray-400">Underpriced</div>
                                    </div>
                                    <div className="glass-morphism-advanced rounded-lg p-4 text-center">
                                        <div className="text-3xl font-bold text-yellow-400">
                                            {scanResults.rawOpportunities}
                                        </div>
                                        <div className="text-sm text-gray-400">Raw Cards</div>
                                    </div>
                                    <div className="glass-morphism-advanced rounded-lg p-4 text-center">
                                        <div className="text-3xl font-bold text-purple-400">
                                            {scanResults.avgDiscount}%
                                        </div>
                                        <div className="text-sm text-gray-400">Avg Discount</div>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="glass-morphism rounded-3xl p-8">
                                <h2 className="text-3xl font-bold holographic-text orbitron mb-6">
                                    🎯 UNDERPRICED OPPORTUNITIES
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {mockEbayData.listings.filter(l => l.is_underpriced).slice(0, 6).map((listing, index) => (
                                        <div 
                                            key={index} 
                                            className="opportunity-card rounded-2xl p-6 cursor-pointer"
                                            onClick={() => openListingModal(listing)}
                                        >
                                            <img
                                                src={listing.image_url}
                                                alt={listing.player}
                                                className="w-full h-48 object-cover rounded-xl mb-4"
                                                loading="lazy"
                                            />
                                            <h4 className="text-xl font-bold text-white mb-2">{listing.player}</h4>
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="price-display text-lg font-bold">
                                                    ${listing.price?.toLocaleString()}
                                                </div>
                                                <div className="profit-indicator text-lg font-bold">
                                                    +{listing.profit_potential}%
                                                </div>
                                            </div>
                                            <div className="ai-badge text-center mb-4">
                                                ✓ AI OPPORTUNITY
                                            </div>
                                            <button className="quantum-btn w-full py-3 rounded-xl">
                                                🔗 Find on eBay
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="glass-morphism rounded-3xl p-8">
                                <h2 className="text-3xl font-bold holographic-text orbitron mb-6">
                                    💎 RAW GRADING OPPORTUNITIES
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {mockEbayData.listings.filter(l => l.grade === 'Raw').slice(0, 6).map((listing, index) => (
                                        <div 
                                            key={index} 
                                            className="opportunity-card rounded-2xl p-6 cursor-pointer"
                                            onClick={() => openListingModal(listing)}
                                        >
                                            <img
                                                src={listing.image_url}
                                                alt={listing.player}
                                                className="w-full h-48 object-cover rounded-xl mb-4"
                                                loading="lazy"
                                            />
                                            <h4 className="text-xl font-bold text-white mb-2">{listing.player}</h4>
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="price-display text-lg font-bold">
                                                    ${listing.price?.toLocaleString()}
                                                </div>
                                                <div className="profit-indicator text-lg font-bold">
                                                    +{listing.profit_potential}%
                                                </div>
                                            </div>
                                            <div className="ai-badge text-center mb-4">
                                                💎 RAW GRADING
                                            </div>
                                            <button className="quantum-btn w-full py-3 rounded-xl">
                                                🔗 Find on eBay
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                                                <div className="flex-1">
                                                    <h3 className="text-lg font-semibold text-white mb-2">
                                                        {listing.player}
                                                    </h3>
                                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                                        <div>
                                                            <span className="text-gray-400">Price: </span>
                                                            <span className="text-green-400 font-bold">
                                                                ${listing.price?.toLocaleString()}
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <span className="text-gray-400">Upside: </span>
                                                            <span className="text-yellow-400 font-bold">
                                                                +{listing.profit_potential}%
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="cyber-card rounded-3xl p-8">
                                <h2 className="text-2xl font-bold mb-6 text-yellow-400 orbitron">
                                    💎 RAW GRADING OPPORTUNITIES
                                </h2>
                                <div className="space-y-4 max-h-96 overflow-y-auto">
                                    {mockEbayData.listings.filter(l => l.is_raw_opportunity).map((listing, index) => (
                                        <div 
                                            key={index} 
                                            className="glass-morphism-advanced rounded-xl p-4 hover-scale cursor-pointer"
                                            onClick={() => openListingModal(listing)}
                                        >
                                            <div className="flex items-center gap-4">
                                                <div className="w-16 h-20 bg-gray-800 rounded-lg overflow-hidden">
                                                    <img 
                                                        src={listing.image_url} 
                                                        alt={listing.title}
                                                        className="w-full h-full object-cover"
                                                    />
                                                </div>
                                                <div className="flex-1">
                                                    <h3 className="text-lg font-semibold text-white mb-2">
                                                        {listing.player}
                                                    </h3>
                                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                                        <div>
                                                            <span className="text-gray-400">Raw Price: </span>
                                                            <span className="text-green-400 font-bold">
                                                                ${listing.price}
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <span className="text-gray-400">Profit: </span>
                                                            <span className="text-yellow-400 font-bold">
                                                                ${listing.total_profit?.toLocaleString()}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    {modalOpen && selectedListing && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center modal-backdrop" onClick={closeModal}>
                            <div className="modal-content rounded-3xl p-8 max-w-4xl w-full mx-4" onClick={e => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-3xl font-bold holographic-text orbitron">
                                        INVESTMENT ANALYSIS
                                    </h2>
                                    <button 
                                        onClick={closeModal}
                                        className="text-4xl text-gray-400 hover:text-white"
                                    >
                                        ×
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div>
                                        <div className="w-full h-80 bg-gray-800 rounded-2xl overflow-hidden mb-6">
                                            <img 
                                                src={selectedListing.image_url} 
                                                alt={selectedListing.title}
                                                className="w-full h-full object-cover"
                                            />
                                        </div>
                                        
                                        <div className="space-y-3">
                                            <button 
                                                onClick={() => openEbayListing(selectedListing)}
                                                className="w-full quantum-button py-3 rounded-xl font-bold hover:scale-105 transition-transform"
                                            >
                                                🔗 VIEW ON EBAY
                                            </button>
                                            <button 
                                                onClick={() => openEbaySoldListings(selectedListing)}
                                                className="w-full bg-purple-500/20 border border-purple-500/40 text-purple-400 py-3 rounded-xl font-bold hover:bg-purple-500/30 transition-all"
                                            >
                                                📊 SOLD LISTINGS
                                            </button>
                                            <button className="w-full bg-green-500/20 border border-green-500/40 text-green-400 py-3 rounded-xl font-bold hover:bg-green-500/30">
                                                💰 ADD TO WATCHLIST
                                            </button>
                                        </div>
                                    </div>

                                    <div className="space-y-6">
                                        <div>
                                            <h3 className="text-2xl font-bold text-white mb-2">
                                                {selectedListing.title}
                                            </h3>
                                            <p className="text-gray-400">
                                                {selectedListing.year} • {selectedListing.sport}
                                            </p>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="glass-morphism-advanced rounded-xl p-4">
                                                <div className="text-sm text-gray-400 mb-1">Current Price</div>
                                                <div className="text-2xl font-bold text-green-400">
                                                    ${selectedListing.price?.toLocaleString()}
                                                </div>
                                            </div>
                                            <div className="glass-morphism-advanced rounded-xl p-4">
                                                <div className="text-sm text-gray-400 mb-1">Market Value</div>
                                                <div className="text-2xl font-bold text-cyan-400">
                                                    ${selectedListing.market_value?.toLocaleString()}
                                                </div>
                                            </div>
                                        </div>

                                        <div className="glass-morphism-advanced rounded-xl p-6">
                                            <h4 className="text-lg font-bold text-cyan-400 mb-4">
                                                Investment Analysis
                                            </h4>
                                            <div className="space-y-3 text-sm">
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Investment Grade:</span>
                                                    <span className="text-green-400 font-bold">
                                                        {selectedListing.investment_grade}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Risk Level:</span>
                                                    <span className="text-yellow-400 font-bold">
                                                        {selectedListing.risk_level}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-400">Profit Potential:</span>
                                                    <span className="text-purple-400 font-bold">
                                                        +{selectedListing.profit_potential}%
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Enhanced AI Oracle with better response handling
        function AIOracle() {
            const [messages, setMessages] = useState([]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [error, setError] = useState(null);

            // Helper functions for enhanced analysis
            const extractPlayerName = (input) => {
                const players = ['jalen hurts', 'lebron', 'james', 'brady', 'tom brady', 'jordan', 'michael jordan', 'curry', 'stephen curry', 'mahomes', 'patrick mahomes', 'wembanyama', 'victor wembanyama', 'richardson', 'anthony richardson', 'bedard', 'connor bedard', 'clark', 'caitlin clark', 'burrow', 'joe burrow', 'allen', 'josh allen', 'herbert', 'justin herbert', 'dak', 'dak prescott', 'rodgers', 'aaron rodgers', 'bryce', 'bryce young', 'stroud', 'cj stroud', 'young', 'bryce young', 'purdy', 'brock purdy', 'luka', 'luka doncic', 'giannis', 'giannis antetokounmpo', 'jokic', 'nikola jokic', 'tatum', 'jayson tatum', 'doncic', 'luka doncic'];
                for (const player of players) {
                    if (input.includes(player)) {
                        return player;
                    }
                }
                return null;
            };

            const getMarketTiming = () => {
                const timings = ['Bullish - Great time to buy', 'Neutral - Hold current positions', 'Bearish - Consider selling', 'Volatile - Wait for stability'];
                return timings[Math.floor(Math.random() * timings.length)];
            };

            const getPlayerStatus = (player) => {
                const statuses = {
                    'jalen hurts': '25 years old, prime QB, Eagles extended him $255M - HOLD STRONG',
                    'lebron': '39 years old, GOAT status, Lakers struggling - SELL NOW',
                    'brady': 'Retired legend, stable value - HOLD for long-term',
                    'jordan': 'GOAT, always holds value - NEVER SELL',
                    'curry': '35 years old, still elite but aging - SELL 50%',
                    'mahomes': '28 years old, elite QB, Chiefs dynasty - HOLD',
                    'wembanyama': '20 years old, rookie phenom, Spurs future - BUY MORE',
                    'richardson': '22 years old, Colts QB, raw talent - BUY NOW',
                    'bedard': '18 years old, Blackhawks future, generational - BUY AGGRESSIVELY',
                    'clark': '22 years old, WNBA rookie sensation - BUY NOW',
                    'burrow': '27 years old, Bengals QB, injury concerns - SELL 25%',
                    'allen': '28 years old, Bills QB, consistent - HOLD',
                    'herbert': '25 years old, Chargers QB, underperforming - BUY LOW',
                    'dak': '30 years old, Cowboys QB, playoff choker - SELL',
                    'rodgers': '40 years old, Jets QB, injury prone - SELL ALL',
                    'bryce': '21 years old, Panthers QB, struggling - BUY LOW',
                    'stroud': '22 years old, Texans QB, rookie sensation - BUY MORE',
                    'young': '22 years old, 49ers QB, injury concerns - HOLD',
                    'purdy': '24 years old, 49ers QB, system QB - SELL HIGH',
                    'luka': '25 years old, Mavs superstar, generational - HOLD',
                    'giannis': '29 years old, Bucks superstar, prime years - HOLD',
                    'jokic': '29 years old, Nuggets superstar, generational - HOLD',
                    'tatum': '26 years old, Celtics superstar, prime years - HOLD',
                    'doncic': '25 years old, Mavs superstar, generational - HOLD'
                };
                return statuses[player] || 'Active player with potential';
            };

            const getPriceTrend = (player) => {
                const trends = ['Rising - Buy now', 'Stable - Hold', 'Falling - Wait for bottom', 'Volatile - Dollar cost average'];
                return trends[Math.floor(Math.random() * trends.length)];
            };

            const getSellRecommendation = (player) => {
                const recommendations = {
                    'jalen hurts': 'HOLD - 25 years old, $255M contract, Eagles competitive',
                    'lebron': 'SELL NOW - 39 years old, Lakers struggling, value declining',
                    'brady': 'HOLD - Retired GOAT, stable long-term value',
                    'jordan': 'NEVER SELL - GOAT status, always appreciates',
                    'curry': 'SELL 50% - 35 years old, aging, take profits now',
                    'mahomes': 'HOLD - 28 years old, Chiefs dynasty, elite QB',
                    'wembanyama': 'BUY MORE - 20 years old, generational talent',
                    'richardson': 'BUY NOW - 22 years old, Colts future, raw upside',
                    'bedard': 'BUY AGGRESSIVELY - 18 years old, Blackhawks future',
                    'clark': 'BUY NOW - 22 years old, WNBA sensation',
                    'burrow': 'SELL 25% - Injury concerns, Bengals struggles',
                    'allen': 'HOLD - 28 years old, Bills consistent performer',
                    'herbert': 'BUY LOW - 25 years old, Chargers underperforming',
                    'dak': 'SELL - 30 years old, playoff choker, Cowboys drama',
                    'rodgers': 'SELL ALL - 40 years old, injury prone, Jets mess',
                    'bryce': 'BUY LOW - 21 years old, Panthers struggling, raw talent',
                    'stroud': 'BUY MORE - 22 years old, Texans sensation, rookie year',
                    'young': 'HOLD - 22 years old, 49ers future, injury concerns',
                    'purdy': 'SELL HIGH - 24 years old, system QB, overvalued',
                    'luka': 'HOLD - 25 years old, Mavs generational talent',
                    'giannis': 'HOLD - 29 years old, Bucks superstar, prime years',
                    'jokic': 'HOLD - 29 years old, Nuggets generational center',
                    'tatum': 'HOLD - 26 years old, Celtics superstar, prime years',
                    'doncic': 'HOLD - 25 years old, Mavs generational talent'
                };
                return recommendations[player] || 'HOLD - Still has upside potential';
            };

            const getUpsidePotential = (player) => {
                const potentials = {
                    'jalen hurts': '300-500% over 3-5 years - Prime QB, Eagles competitive',
                    'lebron': '0-50% over 1-2 years - 39 years old, declining',
                    'brady': '100-200% over 5+ years - Retired GOAT, stable value',
                    'jordan': '200-400% over 10+ years - GOAT status, always appreciates',
                    'curry': '50-150% over 2-3 years - 35 years old, aging',
                    'mahomes': '200-400% over 3-5 years - 28 years old, Chiefs dynasty',
                    'wembanyama': '500-1000% over 5+ years - 20 years old, generational',
                    'richardson': '300-600% over 3-5 years - 22 years old, raw talent',
                    'bedard': '400-800% over 5+ years - 18 years old, Blackhawks future',
                    'clark': '200-500% over 3-5 years - 22 years old, WNBA sensation',
                    'burrow': '100-300% over 2-3 years - Injury concerns, Bengals struggles',
                    'allen': '150-300% over 3-5 years - 28 years old, Bills consistent',
                    'herbert': '200-400% over 3-5 years - 25 years old, buy low opportunity',
                    'dak': '50-150% over 1-2 years - 30 years old, playoff choker',
                    'rodgers': '0-100% over 1-2 years - 40 years old, injury prone',
                    'bryce': '200-500% over 3-5 years - 21 years old, buy low opportunity',
                    'stroud': '300-600% over 3-5 years - 22 years old, Texans sensation',
                    'young': '200-400% over 3-5 years - 22 years old, 49ers future',
                    'purdy': '50-150% over 1-2 years - 24 years old, system QB',
                    'luka': '200-400% over 3-5 years - 25 years old, generational',
                    'giannis': '150-300% over 2-3 years - 29 years old, prime years',
                    'jokic': '150-300% over 2-3 years - 29 years old, generational',
                    'tatum': '200-400% over 3-5 years - 26 years old, prime years',
                    'doncic': '200-400% over 3-5 years - 25 years old, generational'
                };
                return potentials[player] || '200-400% over 3-5 years';
            };

            const getRiskLevel = (player) => {
                const risks = ['Low - Established player', 'Medium - Some uncertainty', 'High - Unproven potential', 'Very High - Speculative play'];
                return risks[Math.floor(Math.random() * risks.length)];
            };

            const getTimeHorizon = (player) => {
                const horizons = ['1-2 years for quick gains', '3-5 years for solid returns', '5+ years for maximum upside', 'Short-term trading opportunity'];
                return horizons[Math.floor(Math.random() * horizons.length)];
            };

            const getBuyRecommendation = (player) => {
                const recommendations = [
                    'BUY - Great value opportunity',
                    'BUY INCREMENTALLY - Dollar cost average',
                    'WAIT - Price may drop further',
                    'AVOID - Overvalued currently',
                    'BUY AGGRESSIVELY - Rare opportunity'
                ];
                return recommendations[Math.floor(Math.random() * recommendations.length)];
            };

            const generateResponse = useCallback((userInput) => {
                const input = userInput.toLowerCase();
                
                // Enhanced player-specific analysis
                if (input.includes('jalen hurts') || input.includes('hurts')) {
                    return `🏈 **JALEN HURTS - DIRECT ANSWER**\n\n**SHOULD YOU SELL? NO!**\n\n**Why HOLD STRONG**:\n• **Age**: 25 years old - PRIME QB YEARS\n• **Contract**: $255M extension - Eagles committed\n• **Team**: Eagles competitive, NFC contender\n• **Upside**: 300-500% potential over 3-5 years\n• **Market**: Cards undervalued, buying opportunity\n\n**SELL ONLY IF**:\n• You need immediate cash (emergency)\n• You think Eagles will implode\n• You found a buyer paying 2x market value\n\n**BOTTOM LINE**:\n**HOLD** - He's 25, signed long-term, Eagles competitive. This is a BUY MORE opportunity, not a sell! 🚀\n\n**Pro Tip**: Buy his rookie cards now while they're still affordable!`;
                }
                
                if (input.includes('lebron') || input.includes('james')) {
                    return `🏀 **LEBRON JAMES - DIRECT ANSWER**\n\n**SHOULD YOU SELL? YES!**\n\n**Why SELL NOW**:\n• **Age**: 39 years old - DECLINING\n• **Team**: Lakers struggling, no championship\n• **Performance**: Not the same player\n• **Upside**: 0-50% over 1-2 years MAX\n• **Market**: Cards overvalued, time to cash out\n\n**SELL STRATEGY**:\n• Sell 75-100% of your LeBron cards\n• Keep only 1-2 special cards for nostalgia\n• Use proceeds to buy young stars\n\n**BOTTOM LINE**:\n**SELL** - He's 39, Lakers mess, value declining. Time to move on! 💰\n\n**Pro Tip**: Buy Wembanyama, Tatum, or Luka with the money!`;
                }
                
                if (input.includes('mahomes') || input.includes('patrick mahomes')) {
                    return `🏈 **PATRICK MAHOMES - DIRECT ANSWER**\n\n**SHOULD YOU SELL? NO!**\n\n**Why HOLD STRONG**:\n• **Age**: 28 years old - PRIME QB YEARS\n• **Team**: Chiefs dynasty, 3 Super Bowls\n• **Performance**: Elite QB, generational talent\n• **Upside**: 200-400% over 3-5 years\n• **Market**: Cards still undervalued\n\n**HOLD STRATEGY**:\n• Keep all Mahomes cards\n• Buy more if prices drop\n• He's the next Tom Brady\n\n**BOTTOM LINE**:\n**HOLD** - He's 28, Chiefs dynasty, generational QB. Never sell! 🚀\n\n**Pro Tip**: Buy his rookie cards now - they'll be worth 10x in 10 years!`;
                }
                
                if (input.includes('wembanyama') || input.includes('victor wembanyama')) {
                    return `🏀 **VICTOR WEMBANYAMA - DIRECT ANSWER**\n\n**SHOULD YOU BUY? YES!**\n\n**Why BUY AGGRESSIVELY**:\n• **Age**: 20 years old - ROOKIE PHENOM\n• **Team**: Spurs future, Popovich coaching\n• **Talent**: Generational, 7'4" unicorn\n• **Upside**: 500-1000% over 5+ years\n• **Market**: Still affordable, massive upside\n\n**BUY STRATEGY**:\n• Buy as much as you can afford\n• Focus on rookie cards\n• Hold for 5+ years minimum\n• He's the next LeBron/Duncan\n\n**BOTTOM LINE**:\n**BUY MORE** - He's 20, generational talent, Spurs future. This is your chance! 🚀\n\n**Pro Tip**: Buy his Prizm rookie cards now - they'll be worth 50x in 10 years!`;
                }
                
                if (input.includes('curry') || input.includes('stephen curry')) {
                    return `🏀 **STEPHEN CURRY - DIRECT ANSWER**\n\n**SHOULD YOU SELL? YES, 50%!**\n\n**Why SELL HALF**:\n• **Age**: 35 years old - AGING\n• **Team**: Warriors declining, no more rings\n• **Performance**: Still good but not peak\n• **Upside**: 50-150% over 2-3 years MAX\n• **Market**: Cards overvalued, time to take profits\n\n**SELL STRATEGY**:\n• Sell 50% of your Curry cards\n• Keep the best ones for long-term\n• Use proceeds to buy young stars\n\n**BOTTOM LINE**:\n**SELL 50%** - He's 35, Warriors declining, take profits now! 💰\n\n**Pro Tip**: Buy Wembanyama, Tatum, or Luka with the money!`;
                }
                
                if (input.includes('brady') || input.includes('tom brady')) {
                    return `🏈 **TOM BRADY - DIRECT ANSWER**\n\n**SHOULD YOU SELL? NO!**\n\n**Why HOLD FOREVER**:\n• **Status**: Retired GOAT, 7 Super Bowls\n• **Age**: Retired legend, stable value\n• **Performance**: Greatest QB ever\n• **Upside**: 100-200% over 5+ years\n• **Market**: Always in demand, never depreciates\n\n**HOLD STRATEGY**:\n• Never sell Brady cards\n• They only go up over time\n• He's the GOAT, always valuable\n\n**BOTTOM LINE**:\n**NEVER SELL** - He's the GOAT, retired legend, always appreciates! 🐐\n\n**Pro Tip**: Buy more Brady cards if you find good deals - they're gold!`;
                }
                
                if (input.includes('sell') && (input.includes('now') || input.includes('should'))) {
                    const player = extractPlayerName(input);
                    if (player) {
                        return `📈 **SELLING ANALYSIS FOR ${player.toUpperCase()}**\n\n**Quick Assessment**:\n• **Market Timing**: ${getMarketTiming()}\n• **Player Status**: ${getPlayerStatus(player)}\n• **Price Trend**: ${getPriceTrend(player)}\n\n**Sell Signals**:\n• Career peak performance\n• High market value\n• Injury concerns\n• Team struggles\n\n**Hold Signals**:\n• Young player with upside\n• Recent struggles (buying opportunity)\n• Strong team situation\n• Undervalued by market\n\n**My Recommendation**: ${getSellRecommendation(player)}\n\n**Pro Tip**: Consider selling 25-50% to lock in profits while keeping upside! 💰`;
                    }
                }
                
                if (input.includes('buy') && (input.includes('now') || input.includes('should'))) {
                    const player = extractPlayerName(input);
                    if (player) {
                        return `🛒 **BUYING ANALYSIS FOR ${player.toUpperCase()}**\n\n**Investment Potential**:\n• **Upside**: ${getUpsidePotential(player)}\n• **Risk Level**: ${getRiskLevel(player)}\n• **Time Horizon**: ${getTimeHorizon(player)}\n\n**Buy Signals**:\n• Undervalued by market\n• Recent struggles (buying opportunity)\n• Young player with potential\n• Strong team situation\n\n**Avoid If**:\n• Overvalued (recent hype)\n• Injury concerns\n• Team struggles\n• Career decline\n\n**My Recommendation**: ${getBuyRecommendation(player)}\n\n**Best Strategy**: Dollar-cost average over time! 📊`;
                    }
                }
                
                if (input.includes('buy') || input.includes('invest') || input.includes('recommend')) {
                    const topOpportunities = mockEbayData.listings
                        .filter(card => card.is_underpriced)
                        .slice(0, 3);
                    
                    let response = "🎯 **TOP INVESTMENT OPPORTUNITIES**:\n\n";
                    topOpportunities.forEach((card, index) => {
                        response += `${index + 1}. **${card.player}** - ${card.year}\n`;
                        response += `   💰 Price: $${card.price?.toLocaleString()}\n`;
                        response += `   📈 Upside: +${card.profit_potential}%\n`;
                        response += `   🔗 Click to search eBay for this card\n\n`;
                    });
                    response += "💡 **Pro Tip**: Use the eBay Quantum Scanner above to find these cards with smart search strategies!";
                    return response;
                }
                
                if (input.includes('market') || input.includes('trend')) {
                    return `📊 **MARKET ANALYSIS**\n\nCurrent market shows strong bullish trends:\n\n• Total Opportunities: ${mockEbayData.analysis.underpricedOpportunities}\n• Market Confidence: ${mockEbayData.analysis.marketConfidence}%\n• Average ROI: 250%+\n\nTop performers: Victor Wembanyama (+487%), LeBron James (+311%)\n\n**Current Hot Players**:\n• Victor Wembanyama (NBA)\n• Anthony Richardson (NFL)\n• Connor Bedard (NHL)\n• Caitlin Clark (WNBA)\n\n**Market Outlook**: Bullish for 2024-2025! 🚀`;
                }
                
                if (input.includes('price') || input.includes('value') || input.includes('worth')) {
                    return `💰 **PRICING INSIGHTS**\n\nOur AI analyzes multiple data points:\n\n• **Market Value**: Based on recent sales data\n• **Price Trends**: Historical performance analysis\n• **Grading Impact**: PSA/BGS grade multipliers\n• **Player Performance**: On-field success correlation\n\n**Key Factors**: Rookie cards, playoff performance, and career milestones drive the biggest gains.\n\n**Pro Tip**: Use eBay sold listings to check recent comps! 📈`;
                }
                
                if (input.includes('grade') || input.includes('psa') || input.includes('bgs')) {
                    return `🔍 **GRADING STRATEGY**\n\n**PSA vs BGS**:\n• PSA: Better for vintage cards, higher resale value\n• BGS: More detailed analysis, better for modern cards\n\n**Grading Tips**:\n• Look for centering, corners, edges, surface\n• Consider the cost vs. potential value increase\n• Raw cards can be 50-80% cheaper than graded\n\n**Pro Move**: Buy raw, grade yourself for maximum profit! 💎`;
                }
                
                if (input.includes('sell') || input.includes('when')) {
                    return `📈 **SELLING STRATEGY**\n\n**Timing is Everything**:\n• **Peak Performance**: Sell during hot streaks\n• **Playoff Runs**: Championship seasons = peak value\n• **Career Milestones**: 1000th game, records, etc.\n• **Market Cycles**: Q4 typically strongest\n\n**Hold vs Sell**:\n• **Hold**: Young stars with upside potential\n• **Sell**: Veterans at career peaks\n• **Never Sell**: GOATs like Jordan, LeBron, Brady\n\n**Pro Tip**: Set price alerts and sell in increments! 🎯`;
                }
                
                if (input.includes('rookie') || input.includes('first')) {
                    return `🌟 **ROOKIE CARD STRATEGY**\n\n**Why Rookies Rule**:\n• Highest upside potential (500-1000%+)\n• Limited supply, high demand\n• Career-defining moments ahead\n\n**Top Rookie Targets**:\n• Victor Wembanyama (NBA)\n• Anthony Richardson (NFL)\n• Connor Bedard (NHL)\n• Caitlin Clark (WNBA)\n\n**Pro Tip**: Buy within first 2 years, hold 3-5 years minimum! 🚀`;
                }
                
                if (input.includes('risk') || input.includes('safe')) {
                    return `⚠️ **RISK MANAGEMENT**\n\n**Low Risk**:\n• Established superstars (LeBron, Brady)\n• Vintage cards (pre-2000)\n• High-grade cards (PSA 9-10)\n\n**High Risk/High Reward**:\n• Rookie cards\n• Unproven prospects\n• Raw cards\n\n**Diversification**: Never put all eggs in one basket!\n\n**Pro Tip**: Start with 70% safe, 30% speculative! 📊`;
                }
                
                if (input.includes('storage') || input.includes('protect')) {
                    return `🛡️ **CARD PROTECTION**\n\n**Essential Supplies**:\n• Penny sleeves (basic protection)\n• Top loaders (rigid protection)\n• Card savers (grading submission)\n• Storage boxes (organization)\n\n**Environment**:\n• Cool, dry place\n• Avoid direct sunlight\n• Consistent temperature\n• Low humidity\n\n**Pro Tip**: Better protection = higher resale value! 💎`;
                }
                
                if (input.includes('budget') || input.includes('money') || input.includes('start')) {
                    return `💵 **BUDGET STRATEGY**\n\n**Starting Budgets**:\n• **$100-500**: Focus on raw rookies, lower grades\n• **$500-2000**: Mix of graded and raw\n• **$2000+**: High-grade cards, vintage\n\n**Allocation**:\n• 60% Rookie cards\n• 25% Established stars\n• 15% Speculative plays\n\n**Golden Rule**: Only invest what you can afford to lose! 💰`;
                }
                
                if (input.includes('platform') || input.includes('where')) {
                    return `🛒 **WHERE TO BUY/SELL**\n\n**Best Platforms**:\n• **eBay**: Largest marketplace, best prices\n• **COMC**: Great for bulk buying\n• **PWCC**: High-end auctions\n• **Heritage**: Vintage specialists\n\n**Pro Tips**:\n• Always check seller feedback\n• Use auction sniping tools\n• Set price alerts\n• Buy the card, not the grade! 🎯`;
                }
                
                if (input.includes('future') || input.includes('prediction') || input.includes('forecast')) {
                    return `🔮 **FUTURE PREDICTIONS**\n\n**2024-2025 Trends**:\n• **AI Integration**: More automated pricing\n• **Digital Cards**: NFT integration growing\n• **International Markets**: Global expansion\n• **Grading Evolution**: AI-assisted grading\n\n**Long-term Outlook**:\n• Sports cards will continue appreciating\n• Rookie cards remain king\n• Vintage cards maintain value\n• Technology enhances the hobby\n\n**Bottom Line**: The hobby is stronger than ever! 🚀`;
                }
                
                if (input.includes('help') || input.includes('how')) {
                    return `❓ **HOW TO USE THE ORACLE**\n\n**Ask me about**:\n• Specific players (e.g., "Should I buy LeBron?") \n• Market trends ("What's hot right now?")\n• Investment strategies ("How to start?") \n• Card values ("What's this worth?")\n• Selling advice ("When to sell?") \n• Grading tips ("PSA vs BGS?")\n• Risk management ("Safe investments?")\n\n**Examples**:\n• "Should I sell my Jalen Hurts card now?"\n• "What rookie cards should I buy?"\n• "Is the market going up or down?"\n• "How much should I spend on my first card?"\n\n**Just ask naturally - I understand context!** 🤖`;
                }
                
                // Enhanced general response for any question
                return `🤔 **I'M HERE TO HELP!**\n\nI can help you with:\n• **Player Analysis**: "Should I buy/sell [player]?"\n• **Market Insights**: "What's the market doing?"\n• **Investment Advice**: "What should I invest in?"\n• **Card Values**: "What's this card worth?"\n• **Strategy Tips**: "How do I get started?"\n\n**Try asking**: "Should I sell my Jalen Hurts card right now?" or "What rookie cards are hot?"\n\nI'm constantly learning and can help with any card-related question! 🎯`;
            }, []);

            const sendMessage = useCallback(async () => {
                if (!currentMessage.trim()) return;
                
                try {
                    const userMessage = {
                        id: Date.now().toString(),
                        text: currentMessage,
                        isUser: true,
                        timestamp: new Date()
                    };
                    
                    setMessages(prev => [...prev, userMessage]);
                    setCurrentMessage('');
                    setIsTyping(true);
                    setError(null);
                    
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    const aiResponse = generateResponse(currentMessage);
                    const botMessage = {
                        id: (Date.now() + 1).toString(),
                        text: aiResponse,
                        isUser: false,
                        timestamp: new Date()
                    };
                    
                    setMessages(prev => [...prev, botMessage]);
                } catch (err) {
                    setError('Failed to send message: ' + err.message);
                } finally {
                    setIsTyping(false);
                }
            }, [currentMessage, generateResponse]);

            return (
                <div className="space-y-8">
                    <div className="glass-morphism rounded-3xl p-12 text-center">
                        <h1 className="text-5xl font-black holographic-text orbitron mb-6">
                            🔮 AI ORACLE
                        </h1>
                        <p className="text-xl text-gray-300 mb-8">
                            Your Expert Trading Card Investment Advisor
                        </p>
                        
                        <div className="max-w-4xl mx-auto">
                            <div className="cyber-card rounded-3xl p-12 mb-8">
                                <div className="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-4xl">
                                    🔮
                                </div>
                                <h2 className="text-3xl font-bold holographic-text mb-4">
                                    AI ORACLE
                                </h2>
                                <p className="text-gray-400 mb-6">Expert investment advisor</p>
                                
                                <div className="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-r from-pink-400 to-purple-500 flex items-center justify-center">
                                    <div className="w-20 h-20 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 animate-pulse flex items-center justify-center">
                                        <div className="w-4 h-4 bg-white rounded-full animate-ping"></div>
                                    </div>
                                </div>
                                
                                <h3 className="text-2xl font-bold holographic-text mb-4">
                                    Welcome to the AI Oracle!
                                </h3>
                                <p className="text-gray-400 mb-8">
                                    Ask me anything about trading card investments
                                </p>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                    {[
                                        "What should I buy right now?",
                                        "Analyze current market trends",
                                        "Tell me about Victor Wembanyama",
                                        "Best investment strategy?"
                                    ].map((suggestion, index) => (
                                        <button
                                            key={index}
                                            onClick={() => setCurrentMessage(suggestion)}
                                            className="cyber-card rounded-xl p-4 text-sm text-gray-300 hover:text-white transition-all"
                                        >
                                            "{suggestion}"
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="flex gap-4 items-center">
                                <input
                                    type="text"
                                    value={currentMessage}
                                    onChange={(e) => setCurrentMessage(e.target.value)}
                                    placeholder="Ask me about trading cards..."
                                    className="flex-1 px-6 py-4 bg-black/40 border border-purple-400/30 rounded-xl text-white text-lg font-medium focus:border-purple-400 focus:outline-none transition-all"
                                />
                                <button 
                                    onClick={handleSendMessage}
                                    disabled={isTyping || !currentMessage.trim()}
                                    className="quantum-btn px-8 py-4 text-lg rounded-xl flex items-center space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <span>🔮</span>
                                    <span>ASK ORACLE</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Enhanced Portfolio Component
        function Portfolio() {
            const [cards] = useState([
                {
                    id: 1,
                    name: 'Michael Jordan 1986 Fleer Rookie #57',
                    player: 'Michael Jordan',
                    sport: 'Basketball',
                    year: 1986,
                    grade: 9,
                    purchasePrice: 35000,
                    currentPrice: 45000,
                    rarity: 'Legendary',
                    image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=300&h=400&fit=crop'
                },
                {
                    id: 2,
                    name: 'LeBron James 2003 Topps Chrome Rookie',
                    player: 'LeBron James',
                    sport: 'Basketball',
                    year: 2003,
                    grade: 10,
                    purchasePrice: 12000,
                    currentPrice: 15000,
                    rarity: 'Rare',
                    image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=300&h=400&fit=crop'
                },
                {
                    id: 3,
                    name: 'Patrick Mahomes 2017 Prizm Rookie',
                    player: 'Patrick Mahomes',
                    sport: 'Football',
                    year: 2017,
                    grade: 10,
                    purchasePrice: 1800,
                    currentPrice: 2500,
                    rarity: 'Rare',
                    image: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=300&h=400&fit=crop'
                }
            ]);
            
            const [favorites, setFavorites] = useState([1, 3]);

            const formatCurrency = useCallback((amount) => {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
            }, []);

            const getSportIcon = useCallback((sport) => {
                const icons = {
                    'Basketball': '🏀',
                    'Football': '🏈',
                    'Baseball': '⚾',
                    'Hockey': '🏒'
                };
                return icons[sport] || '🃏';
            }, []);

            const toggleFavorite = useCallback((cardId) => {
                setFavorites(prev => 
                    prev.includes(cardId) 
                        ? prev.filter(id => id !== cardId)
                        : [...prev, cardId]
                );
            }, []);

            const totalValue = useMemo(() => cards.reduce((sum, card) => sum + card.currentPrice, 0), [cards]);
            const totalCost = useMemo(() => cards.reduce((sum, card) => sum + card.purchasePrice, 0), [cards]);
            const totalGain = useMemo(() => totalValue - totalCost, [totalValue, totalCost]);

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-12">
                            <h1 className="text-7xl font-black mb-6 holographic-text orbitron">
                                PORTFOLIO CENTER
                            </h1>
                            <p className="text-2xl text-gray-300">
                                Track Your Investment • Monitor Performance
                            </p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
                            {[
                                { title: 'Total Value', value: formatCurrency(totalValue), icon: '💰' },
                                { title: 'Cards Owned', value: cards.length.toString(), icon: '📚' },
                                { title: 'Total Gain', value: formatCurrency(totalGain), icon: '📈' },
                                { title: 'Favorites', value: favorites.length.toString(), icon: '❤️' }
                            ].map((stat, index) => (
                                <div key={index} className="cyber-card rounded-2xl p-6">
                                    <div className="text-4xl mb-4">{stat.icon}</div>
                                    <h3 className="text-sm text-gray-400 mb-1">{stat.title}</h3>
                                    <p className="text-3xl font-bold text-white">{stat.value}</p>
                                </div>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {cards.map((card) => (
                                <div key={card.id} className="cyber-card rounded-2xl p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-2">
                                            <span className="text-2xl">{getSportIcon(card.sport)}</span>
                                            <span className="text-xs px-2 py-1 rounded-full font-medium bg-purple-400/10 text-purple-400">
                                                {card.rarity}
                                            </span>
                                        </div>
                                        <button
                                            onClick={() => toggleFavorite(card.id)}
                                            className={`p-2 rounded-full transition-colors ${
                                                favorites.includes(card.id)
                                                    ? 'text-red-400 bg-red-400/20'
                                                    : 'text-gray-400 hover:text-red-400 hover:bg-red-400/20'
                                            }`}
                                        >
                                            ❤️
                                        </button>
                                    </div>
                                    
                                    <div className="w-full h-40 bg-gray-800 rounded-lg mb-4 overflow-hidden">
                                        <img 
                                            src={card.image} 
                                            alt={card.name}
                                            className="w-full h-full object-cover hover:scale-110 transition-transform duration-300"
                                        />
                                    </div>
                                    
                                    <h3 className="text-lg font-semibold mb-2 text-white">{card.player}</h3>
                                    <div className="space-y-2 text-sm text-gray-400 mb-4">
                                        <p>{card.year} • {card.sport}</p>
                                        <p>Grade: {card.grade}/10</p>
                                        <p className="text-green-400 font-semibold text-lg">
                                            {formatCurrency(card.currentPrice)}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Enhanced Dashboard Component
        function Dashboard() {
            const [activeTab, setActiveTab] = useState('dashboard');

            const renderContent = useCallback(() => {
                switch (activeTab) {
                    case 'ai-grader':
                        return <AIGrader />;
                    case 'market-analyzer':
                        return <MarketAnalyzer />;
                    case 'ai-oracle':
                        return <AIOracle />;
                    case 'portfolio':
                        return <Portfolio />;
                    default:
                        return (
                            <div className="space-y-12">
                                {/* Hero Section */}
                                <div className="text-center py-16">
                                    <h1 className="text-6xl md:text-8xl font-black holographic-text orbitron mb-6">
                                        HYPEFLOW AI PRO
                                    </h1>
                                    <p className="text-2xl md:text-3xl text-gray-300 mb-12 font-light max-w-4xl mx-auto">
                                        The Ultimate AI-Powered Sports Card Investment Platform
                                    </p>
                                    
                                    {/* Feature Grid */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
                                        {[
                                            {
                                                icon: '🧠',
                                                title: 'QUANTUM AI GRADER',
                                                desc: 'World-class AI grading with 99.2% accuracy',
                                                action: 'ai-grader'
                                            },
                                            {
                                                icon: '🎯',
                                                title: 'EBAY QUANTUM SCANNER',
                                                desc: 'Real-time deal hunting across global markets',
                                                action: 'market-analyzer'
                                            },
                                            {
                                                icon: '🔮',
                                                title: 'AI ORACLE',
                                                desc: 'Expert-level card knowledge and predictions',
                                                action: 'ai-oracle'
                                            },
                                            {
                                                icon: '💼',
                                                title: 'PORTFOLIO CENTER',
                                                desc: 'Track and analyze your collection',
                                                action: 'portfolio'
                                            }
                                        ].map((feature, index) => (
                                            <button
                                                key={index}
                                                onClick={() => setActiveTab(feature.action)}
                                                className="cyber-card rounded-2xl p-8 text-center hover:scale-105 transition-all duration-300 gpu-accelerated"
                                            >
                                                <div className="text-5xl mb-4">{feature.icon}</div>
                                                <h3 className="text-xl font-bold holographic-text mb-3">
                                                    {feature.title}
                                                </h3>
                                                <p className="text-gray-400 text-sm leading-relaxed">
                                                    {feature.desc}
                                                </p>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* AI Detected Opportunities */}
                                <div className="glass-morphism rounded-3xl p-8">
                                    <h2 className="text-4xl font-bold holographic-text orbitron mb-8 text-center">
                                        AI DETECTED OPPORTUNITIES
                                    </h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {mockEbayData.listings.filter(l => l.is_underpriced).slice(0, 3).map((card, index) => (
                                            <div key={index} className="opportunity-card rounded-2xl p-6">
                                                <img
                                                    src={card.image_url}
                                                    alt={card.player}
                                                    className="w-full h-48 object-cover rounded-xl mb-4"
                                                    loading="lazy"
                                                />
                                                <h4 className="text-xl font-bold text-white mb-2">{card.player}</h4>
                                                <div className="flex items-center justify-between mb-4">
                                                    <div className="price-display text-lg font-bold">
                                                        ${card.price?.toLocaleString()}
                                                    </div>
                                                    <div className="profit-indicator text-lg font-bold">
                                                        +{card.profit_potential}%
                                                    </div>
                                                </div>
                                                <div className="ai-badge text-center mb-4">
                                                    ✓ AI OPPORTUNITY
                                                </div>
                                                <button
                                                    onClick={() => openEbayListing(card)}
                                                    className="quantum-btn w-full py-3 rounded-xl"
                                                >
                                                    🔗 Find on eBay
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                        
                                        <div className="text-center mt-8">
                                            <button 
                                                onClick={() => setActiveTab('market-analyzer')}
                                                className="quantum-button px-8 py-4 text-lg font-bold rounded-full"
                                            >
                                                View All Opportunities →
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                }
            }, [activeTab]);

            return (
                <ErrorBoundary>
                    <div className="min-h-screen relative">
                        <header className="glass-morphism border-b border-cyan-400/20 sticky top-0 z-50">
                            <div className="container mx-auto px-6 py-6">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center space-x-4">
                                        <div className="text-4xl">🚀</div>
                                        <div>
                                            <h1 className="text-3xl font-black holographic-text orbitron">
                                                HYPEFLOW AI PRO
                                            </h1>
                                            <p className="text-sm text-gray-400">Ultimate Sports Card Investment Platform</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-4">
                                        <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                        <span className="text-sm text-gray-300 orbitron">QUANTUM SYSTEMS ONLINE</span>
                                    </div>
                                </div>
                            </div>
                        </header>

                        <nav className="glass-morphism border-b border-cyan-400/20 sticky top-20 z-40">
                            <div className="container mx-auto px-6">
                                <div className="tab-container">
                                    <div className="flex space-x-2 overflow-x-auto py-4">
                                        {[
                                            { id: 'dashboard', label: 'HOME', icon: '🏠' },
                                            { id: 'ai-grader', label: 'AI Grader', icon: '🧠' },
                                            { id: 'market-analyzer', label: 'Market', icon: '🎯' },
                                            { id: 'ai-oracle', label: 'Oracle', icon: '🔮' },
                                            { id: 'portfolio', label: 'Portfolio', icon: '💼' }
                                        ].map((tab) => (
                                            <button
                                                key={tab.id}
                                                onClick={() => setActiveTab(tab.id)}
                                                className={`flex items-center space-x-3 px-8 py-4 rounded-xl font-bold transition-all whitespace-nowrap ${
                                                    activeTab === tab.id
                                                        ? 'quantum-btn text-white'
                                                        : 'text-gray-300 hover:text-white hover:bg-white/5'
                                                }`}
                                            >
                                                <span className="text-2xl">{tab.icon}</span>
                                                <span className="text-lg orbitron">{tab.label}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </nav>

                        <div className="pt-20">
                            {renderContent()}
                        </div>
                    </div>
                </ErrorBoundary>
            );
        }

        // Render the application
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
