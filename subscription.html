<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription - Infinity Sports Card AI Platform</title>
    
    <!-- CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.16.4/dist/framer-motion.min.js"></script>
    
    <!-- Auth System -->
    <script src="auth-system.js"></script>
    <script src="subscription-system.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 168, 204, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #0a0a0f 25%, #1a1a2e 50%, #0f3460 75%, #000000 100%);
            min-height: 100vh;
            color: white;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .infinity-text {
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        
        .glass-morphism {
            background: rgba(0, 212, 255, 0.05);
            backdrop-filter: blur(15px) saturate(150%);
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
        }
        
        .cyber-card {
            background: rgba(0, 100, 255, 0.08);
            border: 1px solid rgba(0, 255, 255, 0.4);
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .cyber-card:hover {
            transform: translateY(-4px) scale(1.02);
            background: rgba(0, 100, 255, 0.15);
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.8);
        }
        
        .quantum-btn {
            background: #00d4ff;
            border: none;
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.1s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .quantum-btn:hover {
            background: #0099cc;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.5);
        }
        
        .quantum-btn:active {
            transform: translateY(0) scale(1);
            transition: all 0.05s ease;
        }
        
        .orbitron {
            font-family: 'Orbitron', monospace;
        }
        
        .infinity-glow {
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        
        .action-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 255, 136, 0.9);
            color: #000;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            pointer-events: none;
            z-index: 1001;
            animation: feedback 0.6s ease-out;
        }
        
        @keyframes feedback {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        
        .loading-spinner {
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .subscription-card {
            background: rgba(0, 100, 255, 0.08);
            border: 1px solid rgba(0, 255, 255, 0.4);
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
        }
        
        .subscription-card:hover {
            transform: translateY(-4px) scale(1.02);
            background: rgba(0, 100, 255, 0.15);
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
            border: 2px solid rgba(0, 255, 255, 0.8);
        }
        
        .subscription-card.current {
            border: 2px solid #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }
        
        .subscription-card.popular {
            border: 2px solid #ffd700;
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        .subscription-card.popular::before {
            content: 'POPULAR';
            position: absolute;
            top: 0;
            right: 0;
            background: #ffd700;
            color: #000;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 0 8px 0 8px;
        }
        
        .subscription-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .subscription-badge.pro {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
        }
        
        .subscription-badge.elite {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li .check {
            color: #00ff88;
            font-weight: bold;
        }
        
        .feature-list li .cross {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .usage-bar {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd700, #00ff88);
            transition: width 0.3s ease;
        }
        
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00d4ff;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
            opacity: 0.7;
        }
        
        .particle:nth-child(2) {
            animation-delay: -2s;
            background: #0099cc;
        }
        
        .particle:nth-child(3) {
            animation-delay: -4s;
            background: #00a8cc;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function SubscriptionPage() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [actionFeedback, setActionFeedback] = useState(null);
            const [subscriptionTiers, setSubscriptionTiers] = useState({});
            const [currentSubscription, setCurrentSubscription] = useState(null);
            const [usageStats, setUsageStats] = useState(null);
            const [billingInfo, setBillingInfo] = useState(null);
            const [featureComparison, setFeatureComparison] = useState([]);
            const [isUpgrading, setIsUpgrading] = useState(false);
            const [selectedTier, setSelectedTier] = useState(null);
            const [paymentMethod, setPaymentMethod] = useState('stripe');
            
            const upgradeRef = useRef(null);

            useEffect(() => {
                checkAuthentication();
                loadSubscriptionData();
            }, []);

            const checkAuthentication = () => {
                if (window.InfinityAuth && window.InfinityAuth.isUserAuthenticated()) {
                    setIsAuthenticated(true);
                    setUser(window.InfinityAuth.getCurrentUser());
                } else {
                    window.location.href = 'login.html';
                }
            };

            const loadSubscriptionData = () => {
                if (window.InfinitySubscription) {
                    // Load subscription tiers
                    setSubscriptionTiers(window.InfinitySubscription.getSubscriptionTiers());
                    
                    // Load current subscription
                    setCurrentSubscription(window.InfinitySubscription.getCurrentSubscription());
                    
                    // Load usage stats
                    setUsageStats(window.InfinitySubscription.getUsageStats());
                    
                    // Load billing info
                    setBillingInfo(window.InfinitySubscription.getBillingInfo());
                    
                    // Load feature comparison
                    setFeatureComparison(window.InfinitySubscription.getFeatureComparison());
                }
                setIsLoading(false);
            };

            const showActionFeedback = (message) => {
                setActionFeedback(message);
                setTimeout(() => setActionFeedback(null), 1500);
            };

            const handleUpgrade = (tier) => {
                setSelectedTier(tier);
                setIsUpgrading(true);
                showActionFeedback(`Upgrading to ${tier} subscription...`);
                
                // Simulate upgrade process
                setTimeout(async () => {
                    if (window.InfinitySubscription) {
                        const result = await window.InfinitySubscription.upgradeSubscription(tier, paymentMethod);
                        
                        if (result.success) {
                            showActionFeedback(`Successfully upgraded to ${tier}!`);
                            loadSubscriptionData(); // Reload data
                        } else {
                            showActionFeedback(`Upgrade failed: ${result.error}`);
                        }
                    }
                    setIsUpgrading(false);
                }, 2000);
            };

            const handleCancel = () => {
                if (window.InfinitySubscription) {
                    const result = window.InfinitySubscription.cancelSubscription();
                    
                    if (result.success) {
                        showActionFeedback('Subscription cancelled successfully');
                        loadSubscriptionData(); // Reload data
                    } else {
                        showActionFeedback(`Cancellation failed: ${result.error}`);
                    }
                }
            };

            const handlePaymentMethodChange = (method) => {
                setPaymentMethod(method);
                showActionFeedback(`Payment method changed to ${method}`);
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="loading-spinner mx-auto mb-4"></div>
                            <div className="text-2xl font-bold infinity-text">Loading Subscription...</div>
                        </div>
                    </div>
                );
            }

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-4">🔒</div>
                            <div className="text-2xl font-bold text-red-400">Access Denied</div>
                            <div className="text-gray-400 mt-2">Please log in to manage your subscription</div>
                            <button 
                                onClick={() => window.location.href = 'login.html'}
                                className="quantum-btn px-6 py-3 rounded-lg mt-4"
                            >
                                Go to Login
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    {/* Floating Particles */}
                    <div className="floating-particles">
                        <div className="particle" style={{left: '10%', top: '20%'}}></div>
                        <div className="particle" style={{left: '80%', top: '30%'}}></div>
                        <div className="particle" style={{left: '60%', top: '70%'}}></div>
                        <div className="particle" style={{left: '30%', top: '80%'}}></div>
                        <div className="particle" style={{left: '90%', top: '60%'}}></div>
                    </div>

                    {/* Action Feedback */}
                    {actionFeedback && (
                        <div className="action-feedback">
                            {actionFeedback}
                        </div>
                    )}

                    {/* Header */}
                    <header className="glass-morphism border-b border-cyan-400/20 sticky top-0 z-50">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <button 
                                        onClick={() => window.location.href = 'dashboard-ultimate.html'}
                                        className="text-cyan-400 hover:text-white transition-colors"
                                    >
                                        ← Back to Dashboard
                                    </button>
                                    <h1 className="text-4xl font-bold infinity-text orbitron">
                                        💳 Subscription
                                    </h1>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="text-right">
                                        <div className="text-sm text-gray-400">Welcome</div>
                                        <div className="text-xl font-bold text-cyan-400">{user?.username}</div>
                                        <div className="subscription-badge">{currentSubscription?.name?.toUpperCase()}</div>
                                    </div>
                                    <button 
                                        onClick={() => window.location.href = 'user-portal.html'}
                                        className="quantum-btn px-4 py-2 rounded-lg"
                                    >
                                        Profile
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="container mx-auto px-6 py-8">
                        {/* Current Subscription */}
                        <div className="glass-morphism rounded-2xl p-8 mb-8">
                            <h2 className="text-3xl font-bold text-cyan-400 mb-6">Current Subscription</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="cyber-card p-6 rounded-lg">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-cyan-400">{currentSubscription?.name}</div>
                                        <div className="text-4xl font-bold text-white">${currentSubscription?.price}/month</div>
                                        <div className="text-sm text-gray-400">Current Plan</div>
                                    </div>
                                </div>
                                <div className="cyber-card p-6 rounded-lg">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-green-400">
                                            {billingInfo?.nextBillingDate ? 
                                                new Date(billingInfo.nextBillingDate).toLocaleDateString() : 
                                                'N/A'
                                            }
                                        </div>
                                        <div className="text-sm text-gray-400">Next Billing Date</div>
                                    </div>
                                </div>
                                <div className="cyber-card p-6 rounded-lg">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-yellow-400">
                                            {billingInfo?.paymentMethod?.toUpperCase() || 'N/A'}
                                        </div>
                                        <div className="text-sm text-gray-400">Payment Method</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Usage Statistics */}
                        {usageStats && (
                            <div className="glass-morphism rounded-2xl p-8 mb-8">
                                <h2 className="text-3xl font-bold text-cyan-400 mb-6">Usage Statistics</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="cyber-card p-6 rounded-lg">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-cyan-400">
                                                {usageStats.gradings.used}
                                                {usageStats.gradings.unlimited ? '' : `/${usageStats.gradings.limit}`}
                                            </div>
                                            <div className="text-sm text-gray-400">AI Grader Scans</div>
                                            {!usageStats.gradings.unlimited && (
                                                <div className="usage-bar">
                                                    <div 
                                                        className="usage-fill" 
                                                        style={{
                                                            width: `${(usageStats.gradings.used / usageStats.gradings.limit) * 100}%`
                                                        }}
                                                    ></div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="cyber-card p-6 rounded-lg">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-green-400">
                                                {usageStats.oracle.used}
                                                {usageStats.oracle.unlimited ? '' : `/${usageStats.oracle.limit}`}
                                            </div>
                                            <div className="text-sm text-gray-400">AI Oracle Questions</div>
                                            {!usageStats.oracle.unlimited && (
                                                <div className="usage-bar">
                                                    <div 
                                                        className="usage-fill" 
                                                        style={{
                                                            width: `${(usageStats.oracle.used / usageStats.oracle.limit) * 100}%`
                                                        }}
                                                    ></div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="cyber-card p-6 rounded-lg">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-purple-400">
                                                {usageStats.portfolio.used}
                                                {usageStats.portfolio.unlimited ? '' : `/${usageStats.portfolio.limit}`}
                                            </div>
                                            <div className="text-sm text-gray-400">Portfolio Cards</div>
                                            {!usageStats.portfolio.unlimited && (
                                                <div className="usage-bar">
                                                    <div 
                                                        className="usage-fill" 
                                                        style={{
                                                            width: `${(usageStats.portfolio.used / usageStats.portfolio.limit) * 100}%`
                                                        }}
                                                    ></div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Subscription Tiers */}
                        <div className="glass-morphism rounded-2xl p-8 mb-8">
                            <h2 className="text-3xl font-bold text-cyan-400 mb-6">Choose Your Plan</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                {Object.entries(subscriptionTiers).map(([tierKey, tier]) => (
                                    <div
                                        key={tierKey}
                                        className={`subscription-card p-6 rounded-lg ${
                                            currentSubscription?.name === tier.name ? 'current' : ''
                                        } ${tierKey === 'pro' ? 'popular' : ''}`}
                                    >
                                        <div className="text-center mb-6">
                                            <div className="text-2xl font-bold text-white">{tier.name}</div>
                                            <div className="text-4xl font-bold text-cyan-400">${tier.price}/month</div>
                                            {tierKey === 'pro' && (
                                                <div className="text-sm text-yellow-400 mt-2">Most Popular</div>
                                            )}
                                        </div>
                                        
                                        <ul className="feature-list mb-6">
                                            {tier.features.map((feature, index) => (
                                                <li key={index}>
                                                    <span className="check">✓</span>
                                                    <span className="text-gray-300">{feature}</span>
                                                </li>
                                            ))}
                                        </ul>
                                        
                                        <div className="text-center">
                                            {currentSubscription?.name === tier.name ? (
                                                <div className="quantum-btn px-6 py-3 rounded-lg opacity-50 cursor-not-allowed">
                                                    Current Plan
                                                </div>
                                            ) : (
                                                <button
                                                    onClick={() => handleUpgrade(tierKey)}
                                                    disabled={isUpgrading}
                                                    className="quantum-btn px-6 py-3 rounded-lg w-full disabled:opacity-50 disabled:cursor-not-allowed"
                                                >
                                                    {isUpgrading && selectedTier === tierKey ? (
                                                        <div className="flex items-center justify-center">
                                                            <div className="loading-spinner mr-2"></div>
                                                            Upgrading...
                                                        </div>
                                                    ) : (
                                                        `Upgrade to ${tier.name}`
                                                    )}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Payment Methods */}
                        <div className="glass-morphism rounded-2xl p-8 mb-8">
                            <h2 className="text-3xl font-bold text-cyan-400 mb-6">Payment Methods</h2>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button
                                    onClick={() => handlePaymentMethodChange('stripe')}
                                    className={`cyber-card p-4 rounded-lg ${
                                        paymentMethod === 'stripe' ? 'border-cyan-400' : ''
                                    }`}
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">💳</div>
                                        <div className="font-bold text-white">Credit Card</div>
                                        <div className="text-sm text-gray-400">Stripe</div>
                                    </div>
                                </button>
                                <button
                                    onClick={() => handlePaymentMethodChange('paypal')}
                                    className={`cyber-card p-4 rounded-lg ${
                                        paymentMethod === 'paypal' ? 'border-cyan-400' : ''
                                    }`}
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">🅿️</div>
                                        <div className="font-bold text-white">PayPal</div>
                                        <div className="text-sm text-gray-400">PayPal</div>
                                    </div>
                                </button>
                                <button
                                    onClick={() => handlePaymentMethodChange('crypto')}
                                    className={`cyber-card p-4 rounded-lg ${
                                        paymentMethod === 'crypto' ? 'border-cyan-400' : ''
                                    }`}
                                >
                                    <div className="text-center">
                                        <div className="text-2xl mb-2">₿</div>
                                        <div className="font-bold text-white">Cryptocurrency</div>
                                        <div className="text-sm text-gray-400">BTC, ETH, USDC</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        {/* Feature Comparison */}
                        <div className="glass-morphism rounded-2xl p-8 mb-8">
                            <h2 className="text-3xl font-bold text-cyan-400 mb-6">Feature Comparison</h2>
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="border-b border-gray-700">
                                            <th className="text-left py-4 px-4 text-white">Feature</th>
                                            <th className="text-center py-4 px-4 text-white">Free</th>
                                            <th className="text-center py-4 px-4 text-white">Pro</th>
                                            <th className="text-center py-4 px-4 text-white">Elite</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {featureComparison.map((row, index) => (
                                            <tr key={index} className="border-b border-gray-700">
                                                <td className="py-4 px-4 text-white">{row.feature}</td>
                                                <td className="py-4 px-4 text-center text-gray-300">{row.free}</td>
                                                <td className="py-4 px-4 text-center text-gray-300">{row.pro}</td>
                                                <td className="py-4 px-4 text-center text-gray-300">{row.elite}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Cancel Subscription */}
                        {currentSubscription?.name !== 'Free' && (
                            <div className="glass-morphism rounded-2xl p-8">
                                <h2 className="text-3xl font-bold text-red-400 mb-6">Danger Zone</h2>
                                <div className="cyber-card p-6 rounded-lg border-red-400">
                                    <div className="text-center">
                                        <div className="text-xl font-bold text-white mb-4">Cancel Subscription</div>
                                        <div className="text-gray-300 mb-6">
                                            You will lose access to premium features at the end of your billing period.
                                        </div>
                                        <button
                                            onClick={handleCancel}
                                            className="quantum-btn px-6 py-3 rounded-lg bg-red-600 hover:bg-red-700"
                                        >
                                            Cancel Subscription
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // Render the application
        ReactDOM.render(<SubscriptionPage />, document.getElementById('root'));
    </script>
</body>
</html>
